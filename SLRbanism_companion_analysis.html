<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Bayi Li">
<meta name="author" content="Claudiu Forgaci">
<meta name="dcterms.date" content="2024-06-11">

<title>Systematic Literature Review for Urbanism</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="SLRbanism_companion_analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="SLRbanism_companion_analysis_files/libs/quarto-html/quarto.js"></script>
<script src="SLRbanism_companion_analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="SLRbanism_companion_analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="SLRbanism_companion_analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="SLRbanism_companion_analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="SLRbanism_companion_analysis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="SLRbanism_companion_analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="SLRbanism_companion_analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="SLRbanism_companion_analysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="SLRbanism_companion_analysis_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="SLRbanism_companion_analysis_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="SLRbanism_companion_analysis_files/libs/jquery-1.12.4/jquery.min.js"></script>
<link href="SLRbanism_companion_analysis_files/libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="SLRbanism_companion_analysis_files/libs/leaflet-1.3.1/leaflet.js"></script>
<link href="SLRbanism_companion_analysis_files/libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="SLRbanism_companion_analysis_files/libs/proj4-2.6.2/proj4.min.js"></script>
<script src="SLRbanism_companion_analysis_files/libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="SLRbanism_companion_analysis_files/libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="SLRbanism_companion_analysis_files/libs/leaflet-binding-2.1.2/leaflet.js"></script>
<script src="SLRbanism_companion_analysis_files/libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="SLRbanism_companion_analysis_files/libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script>
<link href="SLRbanism_companion_analysis_files/libs/HomeButton-0.0.1/home-button.css" rel="stylesheet">
<script src="SLRbanism_companion_analysis_files/libs/HomeButton-0.0.1/home-button.js"></script>
<script src="SLRbanism_companion_analysis_files/libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="SLRbanism_companion_analysis_files/libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="SLRbanism_companion_analysis_files/libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">
<link href="SLRbanism_companion_analysis_files/libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Systematic Literature Review for Urbanism</h1>
<p class="subtitle lead">3. Analysing the corpus</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Bayi Li </p>
             <p>Claudiu Forgaci </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 11, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="the-data" class="level2">
<h2 class="anchored" data-anchor-id="the-data">The data</h2>
<p>In this notebook we will work with a set of full papers in PDF format and their metadata obtained from Web of Science. The full papers are stored in <code>data/collection/PDFs/</code> and the metadata is available in <code>data/collection/savedrecs_wdoi.csv</code> of this repository.</p>
<p>If you want to run the code from this notebook on your computer, please follow our <a href="https://github.com/ClementineCttn/SLRbanism?tab=readme-ov-file#setup">setup instructions</a>.</p>
<div class="note">
<p>The same workflow applies to data obtained from other platforms such as Scopus. Note that variable names need to be adjusted accordingly.</p>
</div>
</section>
<section id="pre-processing" class="level2">
<h2 class="anchored" data-anchor-id="pre-processing">Pre-processing</h2>
<p>In this section, we demonstrate a few relevant pre-processing tasks for the data. The pre-processing tasks include: extracting text from PDF files, combining text data with metadata, subsetting and cleaning the data.</p>
<section id="extract-pdf-text" class="level3">
<h3 class="anchored" data-anchor-id="extract-pdf-text">Task 1: Extract text from PDF files</h3>
<p>Most journal articles are available in PDF format, which is not well suited for quantitative text analysis. Therefore, a common pre-processing task is the extraction of text from PDFs an its storage in a more structured form suitable for analysis. As tools for PDF processing are scarce in the R ecosystem, we rely on Python for this task. The text extraction can be carried out in Python directly or from R via the <code>reticulate</code> package. We adopt the latter approach.</p>
<p>The following code chunk will create a Python environment <code>myenv</code> and install the Python library <code>PyMuPDF</code> for extracting text from PDF files. In subsequent runs, this code chunk will automatically detect the installed environment. The Python script <code>extract-text-from-pdf.py</code> is used to extract text from PDF files.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up and use Python for PDF text extraction</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">virtualenv_create</span>(<span class="at">envname =</span> <span class="st">"myenv"</span>, <span class="at">python =</span> <span class="fu">install_python</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>virtualenv: myenv</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">py_install</span>(<span class="st">"PyMuPDF == 1.21.0"</span>, <span class="at">envname =</span> <span class="st">"myenv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Using virtual environment 'myenv' ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">use_virtualenv</span>(<span class="st">"myenv"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source_python</span>(<span class="st">"py/extract-text-from-pdf.py"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The following code block will extract text from PDF files and structure them into an R data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the location of the data</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>data_root <span class="ot">&lt;-</span> <span class="st">"data/collection/PDFs"</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get PDF file paths</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>pdf_paths <span class="ot">&lt;-</span> <span class="fu">list.files</span>(data_root, <span class="at">full.names =</span> <span class="cn">TRUE</span>, <span class="at">pattern =</span> <span class="st">"*.pdf$"</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract text from PDFs with the Python function `convert_pdf()`</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span> <span class="fu">convert_pdf</span>(pdf_paths) <span class="sc">|&gt;</span> <span class="fu">unlist</span>()</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame with full text data</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>doc_names <span class="ot">&lt;-</span> <span class="fu">list.files</span>(data_root, <span class="at">pattern =</span> <span class="st">"*.pdf"</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>text_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id =</span> <span class="fu">str_sub</span>(doc_names, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">5</span>L), text) <span class="sc">|&gt;</span> </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">"^[0-9]*$"</span>, <span class="st">""</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="metadata" class="level3">
<h3 class="anchored" data-anchor-id="metadata">Task 2: Combine text data with metadata</h3>
<p>Next, we combine the <strong>metadata</strong> directly extracted from the paper database with the <strong>full text</strong> extracted from PDF files, using the <code>id</code> column to join them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>metadata <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/collection/savedrecs_wdoi.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># take only the last name of first author</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>metadata<span class="sc">$</span>refnames <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">strsplit</span>(metadata<span class="sc">$</span>Author.Full.Names, <span class="st">" "</span>), <span class="cf">function</span>(x) x[<span class="dv">1</span>])</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>metadata<span class="sc">$</span>ref <span class="ot">&lt;-</span> <span class="fu">paste</span>(metadata<span class="sc">$</span>refnames, metadata<span class="sc">$</span>Year, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># uncomment the line below and load the text data from file if needed</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># text_df &lt;- read_csv(file = "data/text_df.csv")</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># join the metadata with the text data</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> metadata <span class="sc">|&gt;</span> <span class="fu">left_join</span>(text_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span> <span class="ot">=</span> <span class="st">"id"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="subset-clean-data" class="level3">
<h3 class="anchored" data-anchor-id="subset-clean-data">Task 3: Subset and clean the data</h3>
<p>We only need the columns <code>id</code>, <code>Keywords.Plus</code>, <code>Year</code>, <code>Cited.Reference.Count</code>, and <code>ref</code> from the data frame. We will also rename some columns for better readability.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                   id
1 WOS:000890937200004
2 WOS:A1993MM54300009
3 WOS:000541588500001
4 WOS:000290005800002
5 WOS:000440443600007
6 WOS:000245813700004
                                                                                                                                                                           Keywords
1                                                                                                                                                                                  
2                                                                                                                                                                                  
3                                                                                                                                                              ECONOMIC SEGREGATION
4 US METROPOLITAN-AREAS; ECONOMIC SEGREGATION; RESIDENTIAL SEGREGATION; WAGE INEQUALITY; UNITED-STATES; HOUSING DISCRIMINATION; SPATIAL DYNAMICS; GEOGRAPHIC SCALE; TRENDS; POVERTY
5                                                                                                               ASYMMETRIC INFORMATION; INTERNATIONAL MIGRATION; BRAIN-DRAIN; COSTS
6                                                                                                                                                  GINI INDEX; INEQUALITY; DISTANCE
  Year Cites          ref
1   NA    13   Reardon,NA
2   NA     0  MACSHANE,NA
3 2020    23    Lasso2020
4 2011    97 Reardon,2011
5 2018    21    Bond,2018
6 2007    38 Dawkins,2007</code></pre>
</div>
</div>
</section>
</section>
<section id="basic-exploration-of-the-metadata" class="level2">
<h2 class="anchored" data-anchor-id="basic-exploration-of-the-metadata">Basic exploration of the metadata</h2>
<p>Before looking into we want to gain an overview of the metadata. We will look at the distribution of the number of papers over the years and identify the most cited papers. We do so by asking the following questions:</p>
<section id="question-1-what-is-the-distribution-of-number-of-papers-over-the-years-and-when-were-the-most-cited-papers-published" class="level3">
<h3 class="anchored" data-anchor-id="question-1-what-is-the-distribution-of-number-of-papers-over-the-years-and-when-were-the-most-cited-papers-published">Question 1: What is the distribution of number of papers over the years and when were the most cited papers published?</h3>
<p>To answer this question, we plot <strong>the number of papers by year</strong> overlayed with <strong>high-citation papers</strong>. Note the use of two y axes. We can see that the number of papers has been increasing over the years, with most high-citation papers published in recent years.</p>
<div class="cell">
<div id="lst-papers-per-year" class="r cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-papers-per-year-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;1: Number of papers per year
</figcaption>
<div aria-describedby="lst-papers-per-year-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-papers-per-year"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="lst-papers-per-year-1"><a href="#lst-papers-per-year-1" aria-hidden="true" tabindex="-1"></a><span class="co"># count the number of papers by year</span></span>
<span id="lst-papers-per-year-2"><a href="#lst-papers-per-year-2" aria-hidden="true" tabindex="-1"></a>meta_basics_year <span class="ot">&lt;-</span> meta_basics <span class="sc">%&gt;%</span></span>
<span id="lst-papers-per-year-3"><a href="#lst-papers-per-year-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Year) <span class="sc">%&gt;%</span></span>
<span id="lst-papers-per-year-4"><a href="#lst-papers-per-year-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="lst-papers-per-year-5"><a href="#lst-papers-per-year-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count))</span>
<span id="lst-papers-per-year-6"><a href="#lst-papers-per-year-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-papers-per-year-7"><a href="#lst-papers-per-year-7" aria-hidden="true" tabindex="-1"></a><span class="co"># get the top 10 high-citation papers</span></span>
<span id="lst-papers-per-year-8"><a href="#lst-papers-per-year-8" aria-hidden="true" tabindex="-1"></a>meta_basics_cites <span class="ot">&lt;-</span> meta_basics <span class="sc">%&gt;%</span></span>
<span id="lst-papers-per-year-9"><a href="#lst-papers-per-year-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Cites)) <span class="sc">%&gt;%</span></span>
<span id="lst-papers-per-year-10"><a href="#lst-papers-per-year-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="lst-papers-per-year-11"><a href="#lst-papers-per-year-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-papers-per-year-12"><a href="#lst-papers-per-year-12" aria-hidden="true" tabindex="-1"></a><span class="co"># add the number of high-citation papers to the plot with dual y axis</span></span>
<span id="lst-papers-per-year-13"><a href="#lst-papers-per-year-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(meta_basics_year, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> count)) <span class="sc">+</span></span>
<span id="lst-papers-per-year-14"><a href="#lst-papers-per-year-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="lst-papers-per-year-15"><a href="#lst-papers-per-year-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Number of papers by year"</span>, <span class="at">x =</span> <span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="lst-papers-per-year-16"><a href="#lst-papers-per-year-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> meta_basics_cites, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Cites<span class="sc">/</span><span class="dv">10</span>, <span class="at">label =</span> ref), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"#feb237"</span>) <span class="sc">+</span></span>
<span id="lst-papers-per-year-17"><a href="#lst-papers-per-year-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> meta_basics_cites, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Cites<span class="sc">/</span><span class="dv">10</span>, <span class="at">group =</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="lst-papers-per-year-18"><a href="#lst-papers-per-year-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">1</span>), <span class="at">name =</span> <span class="st">"Number of papers"</span>, <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span>.<span class="sc">*</span><span class="dv">10</span>, <span class="at">name =</span> <span class="st">"High-citation papers"</span>)) <span class="sc">+</span></span>
<span id="lst-papers-per-year-19"><a href="#lst-papers-per-year-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLRbanism_companion_analysis_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div id="lst-papers-per-year" class="r cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-papers-per-year-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;2: Number of papers per year
</figcaption>
<div aria-describedby="lst-papers-per-year-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-papers-per-year"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="lst-papers-per-year-1"><a href="#lst-papers-per-year-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save the plot</span></span>
<span id="lst-papers-per-year-2"><a href="#lst-papers-per-year-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave("output/number_of_papers_by_year_high_citations.png")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
</section>
<section id="question-2-which-are-the-top-10-most-cited-papers-between-2017-2023" class="level3">
<h3 class="anchored" data-anchor-id="question-2-which-are-the-top-10-most-cited-papers-between-2017-2023">Question 2: Which are the top 10 most cited papers between 2017-2023?</h3>
<p>We might also want to focus on the most cited papers, assuming that they are the most influential.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the high-citation papers in recent 5 years</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>papers_cites_recent <span class="ot">&lt;-</span> meta_basics <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">&gt;=</span> <span class="dv">2017</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Cites)) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># get the titles of high-citation papers in recent 5 years</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>papers_cites_recent_titles <span class="ot">&lt;-</span> papers_cites_recent <span class="sc">%&gt;%</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(metadata, <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, Article.Title)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># save it as excel</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(papers_cites_recent_titles, <span class="st">"output/high_citation_papers_recent_5_years.csv"</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>papers_cites_recent_titles</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    id
1  WOS:000681232100001
2  WOS:000722167700007
3  WOS:000691516200004
4  WOS:000419722300001
5  WOS:000702393800014
6  WOS:000454132900009
7  WOS:000658450100001
8  WOS:000602322700001
9  WOS:000482232300001
10 WOS:000518403700010
                                                                                                                 Article.Title
1    Socio-economic segregation in European cities. A comparative study of Brussels, Copenhagen, Amsterdam, Oslo and Stockholm
2              Proximate sources of growth in neighborhood income segregation: Class-selective migration versus in sita change
3       Income segregation's impact on local public expenditures: Evidence from municipalities and school districts, 1980-2010
4                                          Income Segregation between School Districts and Inequality in Students' Achievement
5                                  Discovering income-economic segregation patterns: A residential-mobility embedding approach
6                  Civic Life in the Divided Metropolis: Social Capital, Collective Action, and Residential Income Segregation
7  Exploring the global and local patterns of income segregation in Toronto, Canada: A multilevel multigroup modeling approach
8                                                              On the link between rail transit and spatial income segregation
9                                                              Building Inequality: Housing Segregation and Income Segregation
10                                                                       Technology, talent and economic segregation in cities</code></pre>
</div>
</div>
</section>
</section>
<section id="mapping-case-study-locations" class="level2">
<h2 class="anchored" data-anchor-id="mapping-case-study-locations">Mapping case study locations</h2>
<p>Objectives:</p>
<ol type="1">
<li><p>Introduce different types of mapping for visualising paper count in the literature database.</p></li>
<li><p>Discuss an optimal way to collect data for mapping.</p></li>
<li><p>Provide an automatic mapping method (abstract typology of country boundary) for mapping.</p></li>
</ol>
<p>Input:</p>
<ul>
<li>manual</li>
<li>extracting location from title</li>
<li>extracting location from abstract</li>
<li>if multiple locations are mentioned, multiple records are created</li>
</ul>
<p>Output:</p>
<ul>
<li>interactive map with Leaflet</li>
<li>tiled grid map with template available for QGIS as well</li>
</ul>
<section id="preparing-the-data" class="level3">
<h3 class="anchored" data-anchor-id="preparing-the-data">Preparing the data</h3>
<p>Location information is normally presented in the text. The computational method is to use the <a href="data/world-cities.csv">world cities database</a> to conduct a text match from the abstract or full text. However, the reality is there might be spelled in different way. Thus, it is recommended to collect them or, at least, manually check the accuracy of data collection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mapping <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/map.csv"</span>, <span class="at">options=</span><span class="fu">c</span>(<span class="st">"X_POSSIBLE_NAMES=lng"</span>,<span class="st">"Y_POSSIBLE_NAMES=lat"</span>), <span class="at">crs=</span><span class="dv">4326</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>options:        X_POSSIBLE_NAMES=lng Y_POSSIBLE_NAMES=lat 
Reading layer `map' from data source 
  `/Users/claudiuforgaci/Projects/SLRbanism/data/map.csv' using driver `CSV'
Simple feature collection with 38 features and 5 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -117.134 ymin: -36.85102 xmax: 174.7679 ymax: 53.80327
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
</section>
<section id="visualising-the-data" class="level3">
<h3 class="anchored" data-anchor-id="visualising-the-data">1.2 Visualising the data</h3>
<section id="create-a-interactive-maps-with-the-package-mapview" class="level4">
<h4 class="anchored" data-anchor-id="create-a-interactive-maps-with-the-package-mapview">1. Create a interactive maps with the package <code>mapview</code></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(mapping)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-3c876f82c6aa5448a589" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-3c876f82c6aa5448a589">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[[52.64949613,13.00449643,38.87874127,43.6758091,42.8853745,-23.22030142,50.84944445,24.89994242,33.89490558,10.06587317,45.44636973,32.73026887,52.36388045,45.5492237,42.36477794,-27.46191538,36.57601862,53.80326502,44.64635883,51.52523491,4.709849964,43.66222349,34.77729568,36.28161686,44.98606692,6.691274307,51.34006644,53.80326502,-6.186690994,53.79532347,-23.55351439,31.77323939,35.73573476,38.87874127,48.21110746,-36.85102186,47.23614202,5.01983622],[1.254216236,77.58566655,115.4452033,-79.39109514,-78.87956121000001,-45.90555982,4.35309282,67.03329152000001,35.5011948,105.6097929,9.124230504,-117.1340251,4.879300814,13.73014025,-71.08263929,153.0074565,136.6495091,-1.546717914,-63.58345276,12.33504047,-74.07482424,-79.35211961,102.7119519,49.9981725,-93.24633254,-1.620580669,12.36890008,-1.546717914,106.8267583,-1.762947023,-46.6408995,35.22613038,51.32303729,115.4452033,16.37961293,174.7679002,6.017026985,-1.627777972],6,null,"mapping",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":1,"opacity":0.9,"fill":true,"fillColor":"#6666FF","fillOpacity":0.6},null,null,["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_23&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2014&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>East Anglia, UK&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 52.649496&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td>   1.254216&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_34&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2020&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Bangalore, India&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 13.004496&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td>  77.585667&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_35&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2018&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Baoding, China&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 38.878741&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td> 115.445203&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>4&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_87&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2021&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Toronto, Metro Vancouver, and Calgary in Canada&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 43.675809&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td> -79.391095&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>5&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_88&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2009&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Buffalo, USA&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 42.885374&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td> -78.879561&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>6&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_98&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2012&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>São José dos Campos, Brazil&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td>-23.220301&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td> -45.905560&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>7&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_105&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2019&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Belgium, Bulgaria, Germany, Spain, Portugal&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 50.849444&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td>   4.353093&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>8&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_114&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2015&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Karachi, Pakistan&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 24.899942&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td>  67.033292&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>9&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_128&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2021&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Beirut, Lebanon&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 33.894906&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td>  35.501195&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>10&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_138&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2021&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>MKD region of Vietnam&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 10.065873&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td> 105.609793&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>11&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_142&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2008&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Lorenteggio, Milan, Italy&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 45.446370&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td>   9.124231&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>12&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_156&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2015&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>San Diego, USA&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 32.730269&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td>-117.134025&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>13&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_339&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2022&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Amsterdam, Netherlands&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 52.363880&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td>   4.879301&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>14&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_446&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2013&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Koper, Slovenia&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 45.549224&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td>  13.730140&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>15&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>scopus_4&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2021&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Kendall Square, Cambridge, Massachusetts, USA&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 42.364778&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td> -71.082639&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>16&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>scopus_46&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2023&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Brisbane, Australia&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td>-27.461915&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td> 153.007456&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>17&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>scopus_39&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2012&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Kanazawa, Japan&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 36.576019&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td> 136.649509&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>18&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>scopus_70&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2012&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>EASEL, UK&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 53.803265&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td>  -1.546718&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>19&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>sd_cst2_0&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2017&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Halifax, Canada&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 44.646359&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td> -63.583453&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>20&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>scopus_87&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2014&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Delitzsch, Germany&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 51.525235&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td>  12.335040&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>21&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>scopus_71&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2007&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>BOGOTÁ, Colombia&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td>  4.709850&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td> -74.074824&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>22&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>sd_cst2_64&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2013&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Greater Toronto-Hamilton Area, Canada&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 43.662223&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td> -79.352120&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>23&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>sd_cst2_40&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2018&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>China&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 34.777296&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td> 102.711952&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>24&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_8&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2022&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Qazvin, Iran&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 36.281617&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td>  49.998173&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>25&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_2&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2015&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Twin Cities of Minnesota, USA&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 44.986067&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td> -93.246333&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>26&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_10&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2021&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Kumasi Metropolis in Ghana, Sub-Saharan Africa &emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td>  6.691274&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td>  -1.620581&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>27&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_1&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2010&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Leipzig, Germany&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 51.340066&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td>  12.368900&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>28&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_4&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2014&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>East and South East Leeds (EASEL) district in the UK&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 53.803265&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td>  -1.546718&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>29&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_5&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2023&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Jakarta, Indonesia&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> -6.186691&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td> 106.826758&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>30&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_6&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2023&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Bradford, UK &emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 53.795323&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td>  -1.762947&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>31&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_22&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2020&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Sao Paulo, Brazil&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td>-23.553514&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td> -46.640900&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>32&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_76&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2016&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Downtown Jerusalem, Israeli&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 31.773239&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td>  35.226130&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>33&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_13&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2016&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Tehran, Iran &emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 35.735735&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td>  51.323037&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>34&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_69&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2016&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Baoding, China&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 38.878741&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td> 115.445203&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>35&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_17&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2013&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Vienna, Austria&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 48.211107&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td>  16.379613&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>36&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_52&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2018&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Auckland, New Zealand&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td>-36.851022&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td> 174.767900&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>37&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_14&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2016&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Besançon, France&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td> 47.236142&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td>   6.017027&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>38&emsp;<\/td><\/tr><tr><td>1<\/td><th>ID&emsp;<\/th><td>wos_15&emsp;<\/td><\/tr><tr><td>2<\/td><th>Year&emsp;<\/th><td>2017&emsp;<\/td><\/tr><tr><td>3<\/td><th>Geographical.Area&emsp;<\/th><td>Shama, Ghana&emsp;<\/td><\/tr><tr><td>4<\/td><th>lat&emsp;<\/th><td>  5.019836&emsp;<\/td><\/tr><tr><td>5<\/td><th>lng&emsp;<\/th><td>  -1.627778&emsp;<\/td><\/tr><tr><td>6<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-117.1340251,-36.85102186,174.7679002,53.80326502,true,"mapping","Zoom to mapping","<strong> mapping <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"mapping",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#6666FF"],"labels":["mapping"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"mapping"}]}],"limits":{"lat":[-36.85102186,53.80326502],"lng":[-117.1340251,174.7679002]},"fitBounds":[-36.85102186,-117.1340251,53.80326502,174.7679002,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div>
</section>
<section id="static-map" class="level4">
<h4 class="anchored" data-anchor-id="static-map">2. Static map</h4>
<p>Plot the location of studied area on top of the world map (countries’ boundary).</p>
<p>Load the world map, which will be the base map for the following mapping.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>countries_bound <span class="ot">&lt;-</span> <span class="fu">geojson_sf</span>(<span class="st">"data/map_basis/WB_countries_Admin0_10m/WB_countries_Admin0_10m_small.geojson"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># If you wish to plot the boundaries of countries on the canvas</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(countries_bound) <span class="sc">+</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> FORMAL_EN)) <span class="sc">+</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_none</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLRbanism_companion_analysis_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> countries_bound, <span class="at">colour =</span> <span class="st">"white"</span>, <span class="at">fill =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mapping, <span class="at">colour =</span> <span class="st">"yellow"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_none</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLRbanism_companion_analysis_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the plot</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"output/direct_mapping.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Saving 7 x 5 in image</code></pre>
</div>
</div>
</section>
<section id="tiled-grid-map" class="level4">
<h4 class="anchored" data-anchor-id="tiled-grid-map">3. Tiled grid map</h4>
<section id="summarise-the-number-of-papers-within-different-countries" class="level5">
<h5 class="anchored" data-anchor-id="summarise-the-number-of-papers-within-different-countries">Summarise the number of papers within different countries</h5>
<p>Using the points to join with the countries’ boundary</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>country_tiled_frame <span class="ot">&lt;-</span> <span class="fu">geojson_sf</span>(<span class="st">"data/map_basis/Tile-Grid-Map-Cleaned.geojson"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>countries_bound <span class="ot">&lt;-</span> <span class="fu">st_make_valid</span>(countries_bound)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>summary <span class="ot">&lt;-</span> <span class="fu">st_join</span>(mapping, countries_bound, <span class="at">join =</span> st_within, <span class="at">left =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Because the tiled grid map does not contain all the countries in the world, we need to check which countries (values of <code>WB_A3</code>) are not included in the column <code>alpha-3</code> of country_tiled_frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>summary<span class="sc">$</span>match <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(summary<span class="sc">$</span>WB_A3 <span class="sc">%in%</span> country_tiled_frame<span class="sc">$</span><span class="st">"alpha-3"</span>, <span class="st">"yeah"</span>, <span class="st">"no"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>summary <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(match <span class="sc">==</span> <span class="st">"no"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">'Geographical.Area'</span>, <span class="st">'FORMAL_EN'</span>, <span class="st">'WB_A3'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 1 feature and 3 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 35.22613 ymin: 31.77324 xmax: 35.22613 ymax: 31.77324
Geodetic CRS:  WGS 84
            Geographical.Area          FORMAL_EN WB_A3
1 Downtown Jerusalem, Israeli West Bank and Gaza   PSE
                   geometry
1 POINT (35.22613 31.77324)</code></pre>
</div>
</div>
<p>We can see that the geographical area “Downtown Jerusalem, Israeli”, based on it’s coordinates, is categorised as “West Bank and Gaza”. However, based on the text of the original paper, regardless of the political status, it should be categorised as “Israel”.</p>
<p>In this case, we just recode it to Israel. Specifically, we change the value of WB_A3 from <code>"PSE"</code> to <code>"ISR"</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>summary<span class="sc">$</span>WB_A3[summary<span class="sc">$</span>WB_A3 <span class="sc">==</span> <span class="st">"PSE"</span>] <span class="ot">&lt;-</span> <span class="st">"ISR"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We recheck if the match in the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>summary<span class="sc">$</span>match <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(summary<span class="sc">$</span>WB_A3 <span class="sc">%in%</span> country_tiled_frame<span class="sc">$</span><span class="st">"alpha-3"</span>, <span class="st">"yeah"</span>, <span class="st">"no"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>summary <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(match <span class="sc">==</span> <span class="st">"no"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">'Geographical.Area'</span>, <span class="st">'FORMAL_EN'</span>, <span class="st">'WB_A3'</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 0 features and 3 fields
Bounding box:  xmin: NA ymin: NA xmax: NA ymax: NA
Geodetic CRS:  WGS 84
[1] Geographical.Area FORMAL_EN         WB_A3             geometry         
&lt;0 rows&gt; (or 0-length row.names)</code></pre>
</div>
</div>
<p>Summary the number of papers within different countries:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>summary_2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(summary) <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(WB_A3) <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Read the prepared geojson into spatial data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># join the summary_2 to country_tiled_frame based on the column `WB_A3` (left), and `alpha-3` (right)</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>country_tiled_frame <span class="ot">&lt;-</span> <span class="fu">left_join</span>(country_tiled_frame, summary_2, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"alpha-3"</span> <span class="ot">=</span> <span class="st">"WB_A3"</span>))</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fill the NA with 0 in the column "n"</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>country_tiled_frame<span class="sc">$</span>n[<span class="fu">is.na</span>(country_tiled_frame<span class="sc">$</span>n)] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Save the tiled grid map as a geojson file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">writeLines</span>(<span class="fu">sf_geojson</span>(country_tiled_frame), <span class="st">"output/tiled_grid_mapped.geojson"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plot the tiled grid map:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(country_tiled_frame) <span class="sc">+</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> n), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="at">data =</span> country_tiled_frame[country_tiled_frame<span class="sc">$</span>n <span class="sc">!=</span> <span class="dv">0</span>,], <span class="fu">aes</span>(<span class="at">x=</span> coord_x, <span class="at">y =</span> coord_y, <span class="at">label =</span> <span class="st">`</span><span class="at">alpha-2</span><span class="st">`</span>), <span class="at">label.size =</span> <span class="cn">NA</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_cvi_c</span>(<span class="st">"cvi_greens"</span>) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Number of papers within different countries"</span>) <span class="sc">+</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLRbanism_companion_analysis_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"output/tiled_grid_map.jpg"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">8</span>, <span class="at">units =</span> <span class="st">"in"</span>, <span class="at">dpi =</span> <span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
</section>
<section id="keyword-analysis-wordcloud" class="level2">
<h2 class="anchored" data-anchor-id="keyword-analysis-wordcloud">Keyword analysis (wordcloud)</h2>
<p>Looking at the keywords is a quick way to understand the main topics of the literature. We will create a word cloud for all the keywords and for each time period.</p>
<section id="question-1-what-are-the-main-topics-in-the-literature-as-seen-in-the-keywords" class="level3">
<h3 class="anchored" data-anchor-id="question-1-what-are-the-main-topics-in-the-literature-as-seen-in-the-keywords">Question 1: What are the main topics in the literature as seen in the keywords?</h3>
<p>We will create a word cloud to visualise the most frequent keywords in the literature. We start by removing rows with missing keyword values, as well as stopwords, numbers, extra white spaces and punctuation from the keywords. We then create a document term matrix and calculate the frequency of each word.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove the rows with NA or empty in the column "Keywords"</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>df_kw <span class="ot">&lt;-</span> data[<span class="sc">!</span><span class="fu">is.na</span>(data<span class="sc">$</span>Keywords) <span class="sc">&amp;</span> data<span class="sc">$</span>Keywords <span class="sc">!=</span> <span class="st">""</span>, ]</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># reset the row index</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(df_kw) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create a corpus</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>corpus <span class="ot">&lt;-</span> <span class="fu">Corpus</span>(<span class="fu">VectorSource</span>(df_kw<span class="sc">$</span>Keywords))</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the corpus to lower case</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>corpus <span class="ot">&lt;-</span> <span class="fu">tm_map</span>(corpus, tolower)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in tm_map.SimpleCorpus(corpus, tolower): transformation drops documents</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove punctuation</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>corpus <span class="ot">&lt;-</span> <span class="fu">tm_map</span>(corpus, removePunctuation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in tm_map.SimpleCorpus(corpus, removePunctuation): transformation drops
documents</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove numbers</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>corpus <span class="ot">&lt;-</span> <span class="fu">tm_map</span>(corpus, removeNumbers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in tm_map.SimpleCorpus(corpus, removeNumbers): transformation drops
documents</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># remove whitespace</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>corpus <span class="ot">&lt;-</span> <span class="fu">tm_map</span>(corpus, stripWhitespace)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in tm_map.SimpleCorpus(corpus, stripWhitespace): transformation drops
documents</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>stop_words <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"segregation"</span>, <span class="st">"and"</span>, <span class="st">"the"</span>, <span class="st">"for"</span>, <span class="st">"are"</span>, <span class="st">"was"</span>, <span class="st">"has"</span>, <span class="st">"can"</span>, <span class="st">"not"</span>, <span class="st">"but"</span>, <span class="st">"all"</span>, <span class="st">"any"</span>, <span class="st">"this"</span>, <span class="st">"that"</span>, <span class="st">"with"</span>, <span class="st">"from"</span>, <span class="st">"which"</span>, <span class="st">"who"</span>, <span class="st">"how"</span>, <span class="st">"why"</span>, <span class="st">"when"</span>, <span class="st">"where"</span>, <span class="st">"what"</span>, <span class="st">"who"</span>, <span class="st">"will"</span>, <span class="st">"would"</span>, <span class="st">"could"</span>, <span class="st">"should"</span>, <span class="st">"may"</span>, <span class="st">"might"</span>, <span class="st">"must"</span>, <span class="st">"shall"</span>, <span class="st">"should"</span>, <span class="st">"have"</span>, <span class="st">"had"</span>, <span class="st">"has"</span>, <span class="st">"been"</span>, <span class="st">"were"</span>, <span class="st">"was"</span>, <span class="st">"be"</span>, <span class="st">"is"</span>, <span class="st">"are"</span>, <span class="st">"a"</span>, <span class="st">"an"</span>, <span class="st">"of"</span>, <span class="st">"on"</span>, <span class="st">"in"</span>, <span class="st">"to"</span>, <span class="st">"as"</span>, <span class="st">"at"</span>, <span class="st">"by"</span>, <span class="st">"or"</span>, <span class="st">"if"</span>, <span class="st">"it"</span>, <span class="st">"its"</span>, <span class="st">"their"</span>, <span class="st">"they"</span>, <span class="st">"them"</span>, <span class="st">"there"</span>, <span class="st">"then"</span>, <span class="st">"than"</span>, <span class="st">"so"</span>, <span class="st">"no"</span>, <span class="st">"yes"</span>, <span class="st">"up"</span>, <span class="st">"down"</span>, <span class="st">"out"</span>, <span class="st">"into"</span>, <span class="st">"over"</span>, <span class="st">"under"</span>, <span class="st">"between"</span>, <span class="st">"through"</span>, <span class="st">"about"</span>, <span class="st">"after"</span>, <span class="st">"before"</span>, <span class="st">"between"</span>, <span class="st">"under"</span>, <span class="st">"over"</span>, <span class="st">"above"</span>, <span class="st">"below"</span>, <span class="st">"through"</span>, <span class="st">"across"</span>, <span class="st">"against"</span>, <span class="st">"along"</span>, <span class="st">"around"</span>, <span class="st">"behind"</span>, <span class="st">"beneath"</span>, <span class="st">"beside"</span>, <span class="st">"besides"</span>, <span class="st">"beyond"</span>, <span class="st">"during"</span>, <span class="st">"except"</span>, <span class="st">"inside"</span>, <span class="st">"near"</span>, <span class="st">"off"</span>, <span class="st">"onto"</span>, <span class="st">"outside"</span>, <span class="st">"since"</span>, <span class="st">"toward"</span>, <span class="st">"underneath"</span>, <span class="st">"until"</span>, <span class="st">"upon"</span>, <span class="st">"within"</span>, <span class="st">"without"</span>, <span class="st">"upon"</span>, <span class="st">"mexico"</span>, <span class="st">"saopaulo"</span>, <span class="st">"rio"</span>, <span class="st">"netherlands"</span>, <span class="st">"london"</span>, <span class="st">"europe"</span>, <span class="st">"brazil"</span>, <span class="st">"unitedstates"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># remove stopwords (i.e., less than 3 characters)</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>corpus <span class="ot">&lt;-</span> <span class="fu">tm_map</span>(corpus, removeWords, stop_words)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in tm_map.SimpleCorpus(corpus, removeWords, stop_words): transformation
drops documents</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a document term matrix</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>dtm <span class="ot">&lt;-</span> <span class="fu">TermDocumentMatrix</span>(corpus)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the document term matrix to a matrix</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dtm)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the frequency of each word</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>words <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">rowSums</span>(m), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create a data frame with two columns: word and frequency</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>dfkw_feq <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">word =</span> <span class="fu">names</span>(words), <span class="at">freq =</span> words)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co"># delete intermedia variables</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="co"># rm(corpus, dtm, m, words)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using the keyword frequencies, we can create a word cloud to visualise the most frequent keywords in the literature.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="st">"output/wordcloud_total.png"</span>, <span class="at">width=</span><span class="dv">6</span>,<span class="at">height=</span><span class="dv">5</span>, <span class="at">units=</span><span class="st">'in'</span>, <span class="at">res=</span><span class="dv">300</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>) <span class="co"># for reproducibility </span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">wordcloud</span>(<span class="at">words =</span> dfkw_feq<span class="sc">$</span>word, <span class="at">freq =</span> dfkw_feq<span class="sc">$</span>freq, <span class="at">min.freq =</span> <span class="dv">2</span>, <span class="at">max.words=</span><span class="dv">200</span>, <span class="at">random.order=</span><span class="cn">FALSE</span>, <span class="at">rot.per=</span><span class="fl">0.35</span>, <span class="at">colors=</span><span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">"Dark2"</span>))</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># add a title</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main =</span> <span class="st">"Word Cloud of Keywords"</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>quartz_off_screen 
                2 </code></pre>
</div>
</div>
</section>
<section id="question-2-what-are-the-main-topics-in-the-literature-in-different-time-periods-as-seen-in-the-keywords" class="level3">
<h3 class="anchored" data-anchor-id="question-2-what-are-the-main-topics-in-the-literature-in-different-time-periods-as-seen-in-the-keywords">Question 2: What are the main topics in the literature in different time periods as seen in the keywords?</h3>
<p>Looking at different time periods can help us understand the evolution of the literature. We will divide the time range into three periods: before 2000, 2000-2010, and after 2010.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>time_range <span class="ot">&lt;-</span> <span class="fu">range</span>(df_kw<span class="sc">$</span>Publication.Year)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Divide the time range into 3 periods: before 2000, 2000-2010, and after 2010</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>periods <span class="ot">&lt;-</span> <span class="fu">cut</span>(df_kw<span class="sc">$</span>Year, <span class="at">breaks =</span> <span class="fu">c</span>(time_range[<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span>, <span class="dv">2000</span>, <span class="dv">2010</span>, time_range[<span class="dv">2</span>]), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"before 2000"</span>, <span class="st">"2000-2010"</span>, <span class="st">"after 2010"</span>))</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>df_kw<span class="sc">$</span>periods <span class="ot">&lt;-</span> periods</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Generate the word cloud for each time period.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">unique</span>(df_kw<span class="sc">$</span>periods)) {</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  dfkw_feq <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  corpus <span class="ot">&lt;-</span> <span class="fu">Corpus</span>(<span class="fu">VectorSource</span>(df_kw[df_kw<span class="sc">$</span>periods <span class="sc">==</span> i, ]<span class="sc">$</span>Keywords))</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  corpus <span class="ot">&lt;-</span> <span class="fu">tm_map</span>(corpus, tolower)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  corpus <span class="ot">&lt;-</span> <span class="fu">tm_map</span>(corpus, removePunctuation)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  corpus <span class="ot">&lt;-</span> <span class="fu">tm_map</span>(corpus, removeNumbers)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  corpus <span class="ot">&lt;-</span> <span class="fu">tm_map</span>(corpus, stripWhitespace)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  corpus <span class="ot">&lt;-</span> <span class="fu">tm_map</span>(corpus, removeWords, stop_words)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  dtm <span class="ot">&lt;-</span> <span class="fu">TermDocumentMatrix</span>(corpus)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(dtm)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  words <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">rowSums</span>(m), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>  dfkw_feq <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">word =</span> <span class="fu">names</span>(words), <span class="at">freq =</span> words)</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">png</span>(<span class="fu">paste</span>(<span class="st">"output/wordcloud_"</span>, i, <span class="st">".png"</span>, <span class="at">sep =</span> <span class="st">""</span>), <span class="at">width=</span><span class="dv">6</span>, <span class="at">height=</span><span class="dv">5</span>, <span class="at">units=</span><span class="st">'in'</span>, <span class="at">res=</span><span class="dv">300</span>)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">1234</span>) <span class="co"># for reproducibility </span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">wordcloud</span>(<span class="at">words =</span> dfkw_feq<span class="sc">$</span>word, <span class="at">freq =</span> dfkw_feq<span class="sc">$</span>freq, <span class="at">min.freq =</span> <span class="dv">2</span>, <span class="at">max.words=</span><span class="dv">200</span>, <span class="at">random.order=</span><span class="cn">FALSE</span>, <span class="at">rot.per=</span><span class="fl">0.35</span>, <span class="at">colors=</span><span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">"Dark2"</span>))</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">title</span>(<span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Word Cloud of Keywords in"</span>, i))</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dev.off</span>()</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="text-mining" class="level2">
<h2 class="anchored" data-anchor-id="text-mining">Text mining</h2>
<p>Text mining is a powerful tool for extracting insights from unstructured text data. In this section, we will demonstrate how to perform text mining on the full text of the papers extracted from PDFs. We start by splitting the text into words, a process called tokenisation, and then proceed with word context, word embeddings and topic modelling.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>words <span class="ot">&lt;-</span> <span class="fu">unnest_tokens</span>(text_df, word, text) <span class="sc">|&gt;</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(readr<span class="sc">::</span><span class="fu">parse_number</span>(word))) <span class="sc">|&gt;</span>     <span class="co"># Remove numbers</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(tidytext<span class="sc">::</span>stop_words, <span class="at">by =</span> <span class="st">"word"</span>) <span class="sc">|&gt;</span>           <span class="co"># Remove English stop words</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># anti_join(custom_stop_words, by = "word") |&gt;  # Remove custom stop words</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">nchar</span>(word) <span class="sc">&gt;</span> <span class="dv">3</span>)                  <span class="co"># remove words of max. 3 characters</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>words_count <span class="ot">&lt;-</span> words <span class="sc">|&gt;</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word) <span class="sc">|&gt;</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>words_count</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18,158 × 2
   word              n
   &lt;chr&gt;         &lt;int&gt;
 1 income         8795
 2 segregation    6941
 3 economic       2010
 4 housing        1907
 5 urban          1822
 6 neighborhood   1715
 7 inequality     1701
 8 neighborhoods  1639
 9 data           1563
10 spatial        1469
# ℹ 18,148 more rows</code></pre>
</div>
</div>
<section id="words-in-context-sentences-around-a-specific-word" class="level3">
<h3 class="anchored" data-anchor-id="words-in-context-sentences-around-a-specific-word">Words in context: sentences around a specific word</h3>
<p>We can extract sentences around a specific word of interest to understand the context in which it is used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the word of interest</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>word_of_interest <span class="ot">&lt;-</span> <span class="st">"income"</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract sentences around the word of interest</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>sentences <span class="ot">&lt;-</span> text_df <span class="sc">|&gt;</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(sentence, text, <span class="at">token =</span> <span class="st">"sentences"</span>) <span class="sc">|&gt;</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(sentence, word_of_interest)) <span class="sc">|&gt;</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sentence)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few sentences</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">pull</span>(sentences), <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "three hypotheses suggest thateconomic segregation affects low-income children's educational attainment, but theyprovide different predictions aboutthedirection oftheeffect."                                                                                                                                                                                                                                                                
 [2] "i combine census data with datafrom thepanel study ofincome dynamicstoshowthat an increase in economic segregation between census tracts in the same statehardlychanges overall educational attainment but it exacerbates inequalitybetween high-income and low- incomechildren."                                                                                                                                                            
 [3] "with overall inequalityheldconstant changes in economic inequality within census tracts havelittleeffect on low-income children's educational attainment."                                                                                                                                                                                                                                                                                   
 [4] "but changes in inequalitybetween census tracts reduce theeducational attainment of low-income children."                                                                                                                                                                                                                                                                                                                                     
 [5] "substitutingsegregation between school districts for segregation between census tracts yields thesameconclusions.  at epfl lausanne on march 23, 2015 http://sf.oxfordjournals.org/ downloaded from  studies show that that households became more geographically segregated by income in the u.s. between 1970 and 1990 (jargowsky 1996,1997), but no study has estimated the effect of this increase on children's educational attainment."
 [6] "© the university of north carolina press socialforces, september 2002, 81(l): 153-176  154/ social forces 81:1, september 2002 two hypotheses suggest that economic segregation would reduce the educa- tional attainment of low-income children."                                                                                                                                                                                           
 [7] "it suggeststhat economic segregationbetween school districts reduces low-income children's educational attainment because when poor neighborhoods get poorer they spend less on schooling."                                                                                                                                                                                                                                                  
 [8] "the second hypothesis emphasizes the advantages of affluent neighbors for low-income children."                                                                                                                                                                                                                                                                                                                                              
 [9] "but a third hypothesis suggests that economic segregation could in- creasethe educational attainment oflow-income children."                                                                                                                                                                                                                                                                                                                 
[10] "it holds that competition with affluent neighbors disadvantages low-income children and can cause them to feelrelativelydeprived."                                                                                                                                                                                                                                                                                                           </code></pre>
</div>
</div>
<p>Note the high occurrence of the hyphenated “low-income” in the sentences. This is a common issue in text mining, where hyphenated words are treated as separate words. We can address this in two ways: by replacing hyphens with underscores to treat them as a single word (e.g., “low_income”) or by re-running the analysis with “bigrams” as tokens instead of “words”.</p>
</section>
<section id="words-in-context-word-embeddings" class="level3">
<h3 class="anchored" data-anchor-id="words-in-context-word-embeddings">Words in context: word embeddings</h3>
<p>Word embeddings are dense vector representations of words that capture semantic relationships between words. We use word embeddings to find words that are similar to a word of interest such as “income”? As a rule of thumb, the dataset should have above 1 million tokens (words in this case) for reliable results. The following code chunks demonstrate the steps to calculate word embeddings.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>tidy_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, text) <span class="sc">%&gt;%</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, text) <span class="sc">%&gt;%</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(word) <span class="sc">%&gt;%</span> </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;=</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>n)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>nested_words <span class="ot">&lt;-</span> tidy_data <span class="sc">%&gt;%</span> </span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">words =</span> <span class="fu">c</span>(word))</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>nested_words</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 56 × 2
   id                  words                
   &lt;chr&gt;               &lt;list&gt;               
 1 WOS:000541588500001 &lt;tibble [10,472 × 1]&gt;
 2 WOS:000290005800002 &lt;tibble [20,628 × 1]&gt;
 3 WOS:000440443600007 &lt;tibble [7,949 × 1]&gt; 
 4 WOS:000245813700004 &lt;tibble [6,082 × 1]&gt; 
 5 WOS:000482232300001 &lt;tibble [9,776 × 1]&gt; 
 6 WOS:000240021800011 &lt;tibble [6,811 × 1]&gt; 
 7 WOS:000296301100001 &lt;tibble [8,219 × 1]&gt; 
 8 WOS:000246089600012 &lt;tibble [10,975 × 1]&gt;
 9 WOS:000971949200003 &lt;tibble [19,324 × 1]&gt;
10 WOS:000518403700010 &lt;tibble [6,187 × 1]&gt; 
# ℹ 46 more rows</code></pre>
</div>
</div>
<p>The following code defines a function to slide a window over the words.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>slide_windows <span class="ot">&lt;-</span> <span class="cf">function</span>(tbl, window_size) {</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  skipgrams <span class="ot">&lt;-</span> slider<span class="sc">::</span><span class="fu">slide</span>(</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    tbl,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>.x,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.after =</span> window_size <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">.step =</span> <span class="dv">1</span>,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.complete =</span> <span class="cn">TRUE</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  safe_mutate <span class="ot">=</span> <span class="fu">safely</span>(mutate)</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">map2</span>(skipgrams,</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>              <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(skipgrams),</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>              <span class="sc">~</span> <span class="fu">safe_mutate</span>(.x, <span class="at">window_id =</span> .y))</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>  out <span class="sc">%&gt;%</span> </span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transpose</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pluck</span>(<span class="st">"result"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">compact</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The following code calculates the pointwise mutual information (PMI) between words and windows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multisession)  <span class="co"># for parallel processing</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>tidy_pmi <span class="ot">&lt;-</span> nested_words <span class="sc">%&gt;%</span> </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">words =</span> <span class="fu">future_map</span>(words, slide_windows, <span class="dv">4</span>L)) <span class="sc">%&gt;%</span> </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(words) <span class="sc">%&gt;%</span> </span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(window_id, id, window_id) <span class="sc">%&gt;%</span> </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pairwise_pmi</span>(word, window_id)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>tidy_pmi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 508,274 × 3
   item1       item2            pmi
   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;
 1 economic    international  0.641
 2 review      international  2.31 
 3 vol         international  1.63 
 4 4           international -1.36 
 5 doi         international  2.51 
 6 the         international -0.496
 7 of          international  0.517
 8 income      international -1.45 
 9 segregation international -0.471
10 by          international -2.00 
# ℹ 508,264 more rows</code></pre>
</div>
</div>
<p>The following code calculates the word vectors using the singular value decomposition (SVD) method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>tidy_word_vectors <span class="ot">&lt;-</span> tidy_pmi <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">widely_svd</span>(</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    item1, item2, pmi,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">nv =</span> <span class="dv">100</span>, <span class="at">maxit =</span> <span class="dv">1000</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>tidy_word_vectors</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 162,600 × 3
   item1       dimension   value
   &lt;chr&gt;           &lt;int&gt;   &lt;dbl&gt;
 1 economic            1 -0.0563
 2 review              1  0.0454
 3 vol                 1  0.0435
 4 4                   1  0.0136
 5 doi                 1  0.0452
 6 the                 1 -0.0650
 7 of                  1 -0.0729
 8 income              1 -0.134 
 9 segregation         1 -0.121 
10 by                  1 -0.0655
# ℹ 162,590 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>nearest_neighbors <span class="ot">&lt;-</span> <span class="cf">function</span>(df, token) {</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">widely</span>(</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> {</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>        y <span class="ot">&lt;-</span> .[<span class="fu">rep</span>(token, <span class="fu">nrow</span>(.)), ]</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>        res <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(. <span class="sc">*</span> y) <span class="sc">/</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>          (<span class="fu">sqrt</span>(<span class="fu">rowSums</span>(. <span class="sc">^</span> <span class="dv">2</span>)) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(.[token, ] <span class="sc">^</span> <span class="dv">2</span>)))</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">matrix</span>(res, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">names</span>(res)))</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">sort =</span> <span class="cn">TRUE</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    )(item1, dimension, value) <span class="sc">%&gt;%</span> </span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>item2)</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>tidy_word_vectors <span class="sc">%&gt;%</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbors</span>(<span class="st">"income"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,626 × 2
   item1       value
   &lt;chr&gt;       &lt;dbl&gt;
 1 income      1    
 2 incomes     0.373
 3 come        0.311
 4 segregation 0.289
 5 parent      0.212
 6 watson      0.204
 7 poorest     0.194
 8 lowest      0.191
 9 cumulative  0.189
10 hood        0.189
# ℹ 1,616 more rows</code></pre>
</div>
</div>
<p>Output: A bar chart with top words related to the word of interest</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Words excluded iteratively while creating the LDA model</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom stop words may contain the words used in the literature search query</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>custom_stop_words <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">word =</span> <span class="fu">c</span>(<span class="st">"income"</span>,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"incomes"</span>,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"segregation"</span>,</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"neighbourhood"</span>,</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"neighborhood"</span>,</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"21"</span>,</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"11"</span>))</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>tidy_word_vectors <span class="sc">%&gt;%</span> </span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbors</span>(<span class="st">"income"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>item1 <span class="sc">%in%</span> custom_stop_words<span class="sc">$</span>word) <span class="sc">%&gt;%</span> </span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(value, <span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">reorder</span>(item1, value), value)) <span class="sc">+</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"PMI"</span>, <span class="at">title =</span> <span class="st">"Top words related to 'income'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLRbanism_companion_analysis_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Output: A wordcloud with top words related to the word of interest</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>top_10_words <span class="ot">&lt;-</span> tidy_word_vectors <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nearest_neighbors</span>(<span class="st">"income"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>item1 <span class="sc">%in%</span> custom_stop_words<span class="sc">$</span>word) <span class="sc">%&gt;%</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(value <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">freq =</span> <span class="fu">as.integer</span>(value <span class="sc">*</span> <span class="dv">1000</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(value, <span class="at">n =</span> <span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">#png("output/wordcloud_test.png", width=6,height=5, units='in', res=300)</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>) <span class="co"># for reproducibility </span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">wordcloud</span>(<span class="at">words =</span> top_10_words<span class="sc">$</span>item1, <span class="at">freq =</span> top_10_words<span class="sc">$</span>freq, <span class="at">max.words=</span><span class="dv">400</span>, <span class="at">random.order=</span><span class="cn">FALSE</span>, <span class="at">rot.per=</span><span class="fl">0.35</span>, <span class="at">colors=</span><span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">"Dark2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in wordcloud(words = top_10_words$item1, freq = top_10_words$freq, :
occupational could not be fit on page. It will not be plotted.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add a title</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main =</span> <span class="st">"Word Cloud of Keywords"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLRbanism_companion_analysis_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">#dev.off()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="topic-model" class="level3">
<h3 class="anchored" data-anchor-id="topic-model">Topic model</h3>
<p>We use an LDA topic model to identify dominant topics in a corpus of papers. We start by pre-processing the data and splitting it into words.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Words excluded iteratively while creating the LDA model</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom stop words may contain the words used in the literature search query</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>custom_stop_words <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">word =</span> <span class="fu">c</span>(<span class="st">"income"</span>, <span class="st">"incomes"</span>, <span class="st">"segregation"</span>,</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"neighbourhood"</span>, <span class="st">"neighborhood"</span>))</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>words <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, text, <span class="st">"year"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Publication.Year</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(<span class="at">output =</span> word, <span class="at">input =</span> text) <span class="sc">|&gt;</span>  <span class="co"># remove punctuation, make lower case</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(tidytext<span class="sc">::</span>stop_words, <span class="at">by =</span> <span class="st">"word"</span>) <span class="sc">|&gt;</span>          <span class="co"># remove stop words</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(custom_stop_words, <span class="at">by =</span> <span class="st">"word"</span>) <span class="sc">|&gt;</span>   <span class="co"># remove custom stop words</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">word =</span> <span class="fu">lemmatize_words</span>(word)) <span class="sc">|&gt;</span>        <span class="co"># lemmatise words</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(word) <span class="sc">&gt;=</span> <span class="dv">3</span>)                       <span class="co"># keep words longer than 3 letters</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The LDA model requires a Document Term Matrix (DTM) as input.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>dtm <span class="ot">&lt;-</span> words <span class="sc">|&gt;</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(id, word, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">5</span>) <span class="sc">|&gt;</span>  <span class="co"># minimum term frequency 5</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cast_dtm</span>(id, word, n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We choose the value for the <code>k</code> hyperparameter either empirically or qualitatively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set k empirically</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # This takes around 10 minutes to run and results in a value between 25 and 30</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # which is rather difficult to interpret</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # This might be useful and easy to use if combined with hierarchical representation</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co"># # of topics in a dendrogram - still to be done</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="co"># result &lt;- FindTopicsNumber(</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   dtm,</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   topics = seq(from = 2, to = 30, by = 1),</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   metrics = c("CaoJuan2009",  "Deveaud2014"),</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   method = "Gibbs",</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   control = list(seed = 2023),</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   verbose = TRUE)</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a><span class="co"># k = result$topic[which.max(result$Deveaud2014 - result$CaoJuan2009)]</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Set k qualitatively, based on the researcher's understanding of the literature</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>k <span class="ot">=</span> <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We fit the LDA model and extract topic distributions over terms represented by the <span class="math inline">\(\beta\)</span> statistic and the topic document distributions over topics represented by the <span class="math inline">\(\theta\)</span> statistic. For each topic, we also generate a pseudo-name from the top 5 words.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit LDA model</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>lda <span class="ot">&lt;-</span> <span class="fu">LDA</span>(dtm, <span class="at">k =</span> k, <span class="at">method=</span><span class="st">"Gibbs"</span>,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">control =</span> <span class="fu">list</span>(<span class="at">seed =</span> <span class="dv">2023</span>, <span class="at">iter =</span> <span class="dv">500</span>, <span class="at">verbose =</span> <span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>K = 5; V = 2816; M = 55
Sampling 500 iterations!
Iteration 100 ...
Iteration 200 ...
Iteration 300 ...
Iteration 400 ...
Iteration 500 ...
Gibbs sampling completed!</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract beta and theta statistics from LDA model</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">posterior</span>(lda)<span class="sc">$</span>terms</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">posterior</span>(lda)<span class="sc">$</span>topics </span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Add pseudo-names to topics based on the top 5 words in each topic</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>topic_names <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>n_words <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(beta)) {</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>  name <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">names</span>(<span class="fu">head</span>(<span class="fu">sort</span>(beta[i, ], <span class="at">decreasing =</span> <span class="cn">TRUE</span>), n_words)), <span class="at">collapse =</span> <span class="st">" "</span>)</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>  topic_names <span class="ot">&lt;-</span> <span class="fu">c</span>(topic_names, name)</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div id="lst-ai-prompt" class="r cell-code listing quarto-float">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-ai-prompt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;3: Promt generated from topic model parameters
</figcaption>
<div aria-describedby="lst-ai-prompt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-ai-prompt"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="lst-ai-prompt-1"><a href="#lst-ai-prompt-1" aria-hidden="true" tabindex="-1"></a>keywords <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length =</span> k)</span>
<span id="lst-ai-prompt-2"><a href="#lst-ai-prompt-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-ai-prompt-3"><a href="#lst-ai-prompt-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="lst-ai-prompt-4"><a href="#lst-ai-prompt-4" aria-hidden="true" tabindex="-1"></a>    keywords[i] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"- The words for Topic "</span>, i, <span class="st">" are: "</span>, </span>
<span id="lst-ai-prompt-5"><a href="#lst-ai-prompt-5" aria-hidden="true" tabindex="-1"></a>        topic_names[i], <span class="st">".</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="lst-ai-prompt-6"><a href="#lst-ai-prompt-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="lst-ai-prompt-7"><a href="#lst-ai-prompt-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-ai-prompt-8"><a href="#lst-ai-prompt-8" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste0</span>(<span class="st">"I have "</span>, k, <span class="st">" topics, each described by "</span>, n_words, </span>
<span id="lst-ai-prompt-9"><a href="#lst-ai-prompt-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">" words. The keywords are as follows:</span><span class="sc">\n</span><span class="st">"</span>), keywords, </span>
<span id="lst-ai-prompt-10"><a href="#lst-ai-prompt-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"How would you name these topics? Use maximum two words to name the topics and provide a one-sentence description for each."</span>, </span>
<span id="lst-ai-prompt-11"><a href="#lst-ai-prompt-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>I have 5 topics, each described by 5 words. The keywords are as follows:
- The words for Topic 1 are: college student city quintile index.
- The words for Topic 2 are: house neighborhood city economic inequality.
- The words for Topic 3 are: school child family district neighborhood.
- The words for Topic 4 are: city spatial datum economic urban.
- The words for Topic 5 are: community household tax model public.
How would you name these topics? Use maximum two words to name the topics and provide a one-sentence description for each.</code></pre>
</div>
</div>
<section id="topics-across-the-corpus" class="level4">
<h4 class="anchored" data-anchor-id="topics-across-the-corpus">Topics across the corpus</h4>
<p>Output: Bar charts showing top words in the corpus and in each topic</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>terms <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">posterior</span>(lda)<span class="sc">$</span>terms)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(terms) <span class="ot">&lt;-</span> topic_names</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>terms <span class="ot">&lt;-</span> terms <span class="sc">|&gt;</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">topic =</span> <span class="fu">rownames</span>(terms)) <span class="sc">|&gt;</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>topic,</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"term"</span>,</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"prob"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(term) <span class="sc">|&gt;</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">max_topic =</span> topic[<span class="fu">which.max</span>(prob)]) <span class="sc">|&gt;</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(topic <span class="sc">==</span> max_topic) <span class="sc">|&gt;</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>words_topics <span class="ot">&lt;-</span> words <span class="sc">|&gt;</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(terms, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"word"</span> <span class="ot">=</span> <span class="st">"term"</span>))</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>top_terms <span class="ot">&lt;-</span> words <span class="sc">|&gt;</span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_max</span>(n, <span class="at">n =</span> <span class="dv">20</span>)</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>top_terms <span class="sc">|&gt;</span></span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(terms, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"word"</span> <span class="ot">=</span> <span class="st">"term"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">reorder</span>(word, n), n)) <span class="sc">+</span></span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> max_topic)) <span class="sc">+</span></span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">hjust =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Word"</span>) <span class="sc">+</span></span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"Top "</span>, <span class="dv">20</span>, <span class="st">" most used words in the corpus of theses"</span>)) <span class="sc">+</span></span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLRbanism_companion_analysis_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to approximate the distance between topics</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>svd_tsne <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tsne</span>(<span class="fu">svd</span>(x)<span class="sc">$</span>u)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert DTM into JSON required by the LDAvis package</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>json <span class="ot">&lt;-</span> <span class="fu">createJSON</span>(</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">phi =</span> beta,</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">theta =</span> theta,</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">doc.length =</span> <span class="fu">rowSums</span>(<span class="fu">as.matrix</span>(dtm)),</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">vocab =</span> <span class="fu">colnames</span>(dtm),</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">term.frequency =</span> <span class="fu">colSums</span>(<span class="fu">as.matrix</span>(dtm)),</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">mds.method =</span> svd_tsne,</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.opts =</span> <span class="fu">list</span>(<span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">""</span>)</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>sigma summary: Min. : 33554432 |1st Qu. : 33554432 |Median : 33554432 |Mean : 33554432 |3rd Qu. : 33554432 |Max. : 33554432 |</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Epoch: Iteration #100 error is: 7.73524368453546</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Epoch: Iteration #200 error is: 0.124725360038268</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Epoch: Iteration #300 error is: 0.11054152551293</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Epoch: Iteration #400 error is: 0.110478500747757</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Epoch: Iteration #500 error is: 0.110466022670987</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Epoch: Iteration #600 error is: 0.110464349760773</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Epoch: Iteration #700 error is: 0.110464296580877</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Epoch: Iteration #800 error is: 0.110464296040745</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Epoch: Iteration #900 error is: 0.110464296031206</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Epoch: Iteration #1000 error is: 0.110464296023228</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualise topics model with LDAvis</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>LDAvis<span class="sc">::</span><span class="fu">serVis</span>(json)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: servr</code></pre>
</div>
</div>
</section>
<section id="evolution-of-topics" class="level4">
<h4 class="anchored" data-anchor-id="evolution-of-topics">Evolution of topics</h4>
<p>Output: Plots showing the change in relative importance of topics and top words over the years.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>topic_prop_per_year <span class="ot">&lt;-</span> theta</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(topic_prop_per_year) <span class="ot">&lt;-</span> topic_names</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>viz_df_with_year <span class="ot">&lt;-</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">data.frame</span>(topic_prop_per_year,</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">document =</span> <span class="fu">factor</span>(<span class="fu">str_sub</span>(</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">rownames</span>(topic_prop_per_year), <span class="dv">1</span>, <span class="dv">20</span>)),</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">check.names =</span> <span class="cn">FALSE</span>),</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>document,</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"topic"</span>,</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">mutate</span>(data, <span class="at">id =</span> <span class="fu">as.factor</span>(id), <span class="st">"year"</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Publication.Year</span><span class="st">`</span>), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"document"</span> <span class="ot">=</span> <span class="st">"id"</span>))</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot topic proportions per year</span></span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>viz_df_with_year <span class="sc">|&gt;</span> </span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(year), <span class="at">y =</span> value, <span class="at">fill =</span> topic)) <span class="sc">+</span> </span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span></span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">name =</span> <span class="st">"Topics"</span>) <span class="sc">+</span></span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Publication year"</span>) <span class="sc">+</span></span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Proportion of topics"</span>) <span class="sc">+</span></span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Topic proportions per year"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLRbanism_companion_analysis_files/figure-html/evolution-topics-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"output/topics-over-years.png"</span>, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>top_terms <span class="ot">&lt;-</span> words <span class="sc">|&gt;</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(n, <span class="at">n =</span> <span class="dv">12</span>)</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>word_order <span class="ot">&lt;-</span> words <span class="sc">|&gt;</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(word, year) <span class="sc">|&gt;</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year,<span class="sc">-</span>n) <span class="sc">|&gt;</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">relative_frequency =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">round</span>(<span class="fu">rank</span>(<span class="sc">-</span>n), <span class="dv">0</span>)) <span class="sc">|&gt;</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(word <span class="sc">%in%</span> top_terms<span class="sc">$</span>word <span class="sc">&amp;</span> word <span class="sc">!=</span> <span class="st">"lihtc"</span>)</span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(word_order,</span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(</span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> year,</span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> relative_frequency,</span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> word,</span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">label =</span> rank</span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>       )) <span class="sc">+</span></span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># aes(fill = "white") +</span></span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">lwd =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_line() +</span></span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_point(size = 8, shape = 21, fill = "white", stroke = 1.2) +</span></span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_text(ggplot2::aes(x = grad_year), color = "black") +</span></span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span> </span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ylab</span>(<span class="st">"Frequency (%)"</span>) <span class="sc">+</span></span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> word) <span class="sc">+</span></span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb90-36"><a href="#cb90-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>),</span>
<span id="cb90-37"><a href="#cb90-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="SLRbanism_companion_analysis_files/figure-html/evolution-top-terms-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave("output/words-over-years.png", width = 10, height = 7)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>