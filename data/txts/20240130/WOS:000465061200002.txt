journal of economic behavior and organization 159 15 35  contents lists available at sciencedirect  journal of economic behavior and organization  journal homepage www.elsevier.com locate jebo  residential income segregation a behavioral model of the  housing market p82  marco pangallo a , b , , jean pierre nadal c , d , annick vignes c , e  a institute for new economic thinking at the oxford martin school, university of oxford, oxford ox26ed, uk  b mathematical institute, university of oxford, oxford ox13lp, uk  c centre d analyse et de math matique sociales, cole des hautes tudes en sciences sociales, 54 bd raspail, paris 75006, france  d laboratoire de physique statistique, cole normale sup rieure, 24 rue lhomond, paris 75231, france  e cole des ponts paristech, 6 8 avenue blaise pascal, champs sur marne 77455, france  a r t i c l e i n f o  article history  received 7 december 2017  revised 20 october 2018  accepted 22 january 2019  available online 6 february 2019  jel classi cation  c63  d31  r23  r31  keywords  agent based model  housing market  spatial segregation  aspiration level heuristic  income inequality a b s t r a c t  we represent the functioning of the housing market and study the relation between in  come segregation, income inequality and house prices by introducing a spatial agent based  model . differently from traditional models in urban economics, we explicitly specify  the behavior of buyers and sellers and the price formation mechanism. buyers who differ  by income select among heterogeneous neighborhoods using a probabilistic model of res  idential choice sellers employ an aspiration level heuristic to set their reservation offer  price prices are determined through a continuous double auction. we rst provide an ap  proximate analytical solution of the abm, shedding light on the structure of the model  and on the effect of the parameters. we then simulate the abm and nd that a more  unequal income distribution lowers the prices globally, but implies stronger segregation   a spike in demand in one part of the city increases the prices all over the city  subsidies are more e cient than taxes in fostering social mixing.   2 0 1 9 elsevier b.v. all rights reserved.  1. introduction  the allocation of people into the most productive cities is becoming an issue of central importance in a globalized world.  for example, hsieh and moretti calculate that u.s. gdp could be 36 higher, had workers been able to settle in the  most productive areas. within cities, the place where people live and the way they are distributed has tremendous con  sequences on educational and labor opportunities and on the provision of public goods .  spatial segregation of households along different income groups in uences the wealth distribution and contributes to   p82 we thank seminar participants at wehia 2016, eaepe 2016, iscpif, sccs 2015, ires piemonte and inet oxford, in particular henri berestycki, allan  davids, j. doyne farmer, michele loberto, mauro napoletano, david pugh and matteo richiardi, for helpful comments. we also thank florian artinger and  gerd gigerenzer for pointing us to their work on aspiration level heuristics, and marco ranaldi, r. maria del rio chanona and two anonymous reviewers  for carefully reading the manuscript. a previous version of this manuscript circulated under the title price formation on a housing market and spatial  income segregation . this paper reuses material from the master thesis of mp at the university of torino. mp especially thanks pietro terna, who was the  main advisor of his thesis, for insightful and frequent discussions.   corresponding author at institute for new economic thinking at the oxford martin school, university of oxford, oxford ox26ed, uk.  e mail address marco.pangallo maths.ox.ac.uk .  https doi.org 10.1016 j.jebo.2019.01.010  0167 2681 2019 elsevier b.v. all rights reserved. 16 m. pangallo, j. p. nadal and a. vignes journal of economic behavior and organization 159 15 35  income inequality . a better understanding of the relation between segrega  tion, income inequality and house prices and of the policies that are designed to deal with these issues is the main focus of  this paper.  from a theoretical perspective, the residential income distribution has traditionally been studied using spatial equilib  rium models . these models assume that for each income group there exists a  constant utility level across the city, and solve for the equilibrium prices yielding the same utility in each neighborhood.  this framework allows for several non trivial insights about the residential choices of fully optimizing agents. however, it  does not explicitly represent the behavior of buyers and sellers and does not illustrate the market dynamics that lead some  households to segregate in certain areas of the city .  in this paper, we build on a substantial body of work on agent based models of the housing market to introduce  a parsimonious and tractable abm speci cally suited to study income segregation. differently from spatial equilibrium mod  els, the outcomes of our abm result from unconstrained interactions between economic agents. indeed, buyers and sellers  follow simple behavioral rules and heuristics and their interactions determine prices and segregation patterns without the  imposition of any aggregate constraint such as equilibrium. this is useful for various reasons.  on one hand, explicitly representing the functioning of the housing market makes it possible to provide more realistic  narratives than in spatial equilibrium models, for a variety of phenomena. consider for example the mechanism that segre  gates poor households out of the most attractive locations in a city, de ned as the places with highest density of amenities .  in the spatial equilibrium model of brueckner et al. , segregation occurs when the marginal valuation of amenities  rises sharply with income, so that high income households are willing to bid more than low income households to reside  in the place with most amenities. 1 this means that the rich value amenities more than the poor do. in our abm, rich and  poor households value amenities in the same way, but segregation is simply explained by the bidding process and by the  market dynamics poor households would like to live in the most attractive places, but as the prices go up they cannot  afford it.  on the other hand, modeling the housing market as the outcome of decentralized and unconstrained interactions makes  it possible to fully consider various forms of heterogeneity. in this paper we focus on income heterogeneity among buyers,  to study how income inequality shapes house prices and residential income segregation. we show that higher income in  equality worsens income segregation, but reduces the average level of the prices. we also study how subsidies and taxes  may foster social mixing, showing that these policies have different effects on distinct parts of the income distribution. this  reinforces the importance of heterogeneity in evaluating the effectiveness of such policies.  the building blocks of our abm are the behavioral rules for buyers and sellers and the price formation mechanism.  the buyers, who differ by income, have to select among heterogeneous neighborhoods where they search for a dwelling.  instead of maximizing their expected utility, buyers select a neighborhood with a probability proportional to their utility,  as in discrete choice theory . 2 the sellers determine their reservation price t h e minimum price  they are willing to accept b y employing an aspiration level heuristic . this means that sellers try to apply a markup on the  market price at the time when they put their dwelling on sale, and progressively reduce their reservation price if their sale  is unsuccessful. 3 many models of the housing market assume that sellers act optimally conditional on the distribution of  offers by potential buyers . here we follow instead the fast and frugal heuristics paradigm and assume that sellers employ a xed selling rule, without an explicit attempt to optimize pro ts . given that in real housing markets information is limited and dispersed, using simple heuristics may in  fact be optimal . finally, in our abm buyers and sellers are matched through a continuous  double auction taking place in each neighborhood at every time step. this represents bilateral bargaining in a stylized way.  the market price in each neighborhood is simply the average of the prices of the transactions that occurred there.  we begin analyzing the model by nding an approximate analytical solution of the abm. our strategy is to start from the  simplest setting e . g . all buyers have the same income a n d to increase the complexity of the model in a modular way.  we do not attempt at nding a general solution, which would be unfeasible, but we provide insights in speci c settings  that are valid in the most complex settings too. from a methodological point of view, this approach provides two main  contributions. first, we show that substantial simpli cations can still capture some important aspects of an abm while  allowing for mathematical tractability, as in gualdi et al. . second, the closed form solutions provide insights that can  be used for calibration. for instance, some parameters only occur as a combination , so it is su cient to analyze the effect of one parameter while holding the other xed. in applied mathematics and  physics, these combinations are known as effective parameters .  we then simulate the abm and focus on the relation between residential segregation, income distribution of the buy  ers, house prices and policies. first, we nd that stronger income inequality leads to stronger residential segregation, in  accordance with empirical evidence . to the best of our knowledge, our model is the rst to  account for this empirical fact. interestingly, stronger income inequality also leads to lower average prices at the city level,  as empirically con rmed too. m tt nen and tervi explain this stylized fact by introducing a matching model with  1 brueckner et al. assume that this place is the center of the city.  2 epple and platt and bayer et al. introduce discrete choice theory into spatial equilibrium models.  3 this concept was rst proposed by simon , and successively developed in search theory . m. pangallo, j. p. nadal and a. vignes journal of economic behavior and organization 159 15 35 17  an optimal assignment rule between households acting as buyers and households acting as sellers. in our abm, this nding  is simply explained by the price formation mechanism. as income inequality increases, fewer richer households bid higher,  while the majority of households bid lower. because each buyer only bids for one dwelling and the market price at each  location is the average of all transaction prices, the global effect is negative.  second, we nd that a spike in demand in one part of the city increases the prices all over the city. we model the rise  of demand as an additional in ux of high income households in the most attractive locations, mimicking the process of rich   foreigners trying to purchase properties in the city . this nding can be interpreted as follows.  an increase of the prices in high income neighborhoods implies that some of the households that would have considered  moving there move instead to low income locations. this is due to a substitution effect with the non housing consumption  good that buyers also consider in their utility function. therefore, the prices increase at the least attractive locations too  and the lowest income households get segregated out of the city. favilukis and van nieuwerburgh come to the same  conclusion within an overlapping generations model, and this nding gets some empirical support from cvijanovic and  spaenjers and s .  third, we implement a system of ad valorem taxes and subsidies on buyers, and investigate which policy is most effective  at fostering social mixing. low income households receive subsidies, whereas high income households have to pay a buyer  transaction tax. effectively, these policies reduce the income spread between households, but the effect is different if they  target the low end or the high end of the income distribution. subsidies directly target low income households and make it  possible for them to buy properties in previously not affordable neighborhoods. taxes on the contrary reduce the reservation  prices of high income households, but have no signi cant effect on transaction prices because transaction prices are still  below the reservation prices of the rich. note that in our model the only transmission channel for taxes is through reducing  the reservation prices. as we assume inelastic global demand, taxes do not crowd out high income households . 4 we nally perform a welfare analysis of the different policies, concluding that both subsidies and taxes increase  the welfare of poor households at the expense of the welfare of rich households. the change in social welfare is negative  if one considers a utilitarian welfare function, but it is positive according to a rawlsian welfare function .  we conclude this introduction relating our model to other abms of the housing market, and laying out a roadmap.  relation to the literature on agent based models of the housing market. with respect to the rest of the literature, we designed  our abm to be parsimonious and tractable, yet with a su ciently detailed description of the economic forces that shape the  housing market. this choice was in part to ensure some mathematical tractability. however, we also wanted our agents to  behave according to simple heuristics, as this may be optimal in situations in which information is limited and dispersed  , such as in housing markets.  we start comparing our model to some of the earliest abms modeling housing markets and income segregation.  feitosa et al. show how segregation can emerge even if one considers the simplest setting with the minimal num  ber of parameters. jackson et al. also introduce a relatively simple model, focusing on how the interaction between  different classes of agents may lead to gentri cation.  the opposite end of the complexity spectrum is taken by gilbert et al. they build an abm where some houses  can be constructed, others are demolished, some agents may put their apartment on sale because they lost their job, etc.  the complexity of our abm is in between the contributions of feitosa et al. and jackson et al. and that of  gilbert et al. . filatova et al. introduce an abm with a similar complexity to the model in the present paper,  but they assume that the reservation price of the sellers is just 25 more of the so called agricultural rent .  our aim here is to represent the supply side in a more detailed way. we mostly build on gauvin et al. , by which our  model shares many assumptions but differs substantially on the behavioral rules and the market mechanism.  ettema represents the supply side in a very detailed way. he assumes that sellers calculate the probability to sell  at each list price, and choose the optimal expected sale price taking into account the disutility of a delay in selling. moreover,  sellers use bayesian learning to update their perceived probabilities of selling. as mentioned above, in our abm we favor a  simpler heuristic to determine the list price. magliocca et al. represent the formation of a city through the interaction  of land and housing markets. they highlight the importance of path dependence in determining the shape of the city. in  our abm we start with an existing city and focus on the long run prices and segregation patterns if the current state of the  city was to persist. in this situation we do not nd that path dependency plays a signi cant role. delloye et al. also  consider path dependency, but the shape of the city is determined by the strength of agglomeration economies. the abms  in delloye et al. and lemoy et al. are speci cally designed to potentially reach the equilibrium of spatial  equilibrium models . in our abm we do not have this goal, and even when the system reaches a steady state   this is not an equilibrium in the typical sense of urban economics.  huang et al. systematically study the effect of heterogeneity on the outcomes of the abm. they focus on two types  of heterogeneity income heterogeneity and preference heterogeneity. in our abm we also consider income heterogeneity.  preference heterogeneity follows from different budget constraints among buyers, but is not modeled explicitly by letting  4 however, at least for the very top of the income distribution, demand is likely to be quite inelastic if houses are purchased as a primary residence.  taxes could instead discourage investors and secondary residence buyers. 18 m. pangallo, j. p. nadal and a. vignes journal of economic behavior and organization 159 15 35  fig. 1. schematic representation of the model. the city is a grid of locations x , with center o , linear size l and distance a between locations.  at each location there are n identical housing units, and space is characterized by different levels of attractiveness . at every time step, gamma1 buyers come to the city from the outside and current inhabitants put their dwelling on sale with probability . at each location and every time step,  buyers and sellers are matched through a continuous double auction, here visually depicted with discrete demand and supply curves constructed from the  reservation prices of the agents.  different agents have different parameters in their utility function. harting and radi study the relation between  income heterogeneity and ethnic preferences, nding complex non linear relations among these variables. in particular, they   nd that subsidies may worsen segregation if they alter the delicate balance between income and ethnic preferences. this  effect is absent in our model as we do not have ethnic preferences, and we nd that subsidies have the most positive effect  on social mixing. it should also be noted that the abm of harting and radi is not spatially explicit, while our abm  is.  a nal dimension in which our model relates to the rest of the literature is the use of data to micro calibrate the agents  and the parameters. geanakoplos et al. and baptista et al. use a wealth of microdata to calibrate non spatial  housing market abms and study implications on systemic risk, while filatova and de koning et al. introduce  geographically detailed features in their spatial abms through the inclusion of gis information. our goal here is not to  calibrate our model to a speci c city or country, although we do calibrate one parameter on real data as it is stable across  different datasets .  roadmap. the rest of this paper is organized as follows. in section 2 we present the model we then give an approximate  mathematical description of it in section 3 , and provide results from the numerical simulations in section 4 . section 5 con  cludes.  2. model  a schematic representation of the model is provided in fig. 1 , and an odd d  description of the abm is given in appendix a . our model considers an already formed city, mathematically de ned as a grid  in the cartesian plane. a speci c point of the grid is a location . space is characterized by different levels of attractiveness , a  variable subsuming exogenous intrinsic features and endogenous social characteristics. time is discrete. at each time step  1. some households t h e buyers come to the city from outside and try to purchase a dwelling in the metropolitan  housing market. they select a location with a probability proportional to their expected utility at that location.  2. households already living in the city decide to put their dwelling on sale with a certain probability. we refer to the  households with a dwelling on the market as the sellers . m. pangallo, j. p. nadal and a. vignes journal of economic behavior and organization 159 15 35 19  3. the buyers have heterogeneous incomes and bid a certain amount in order to secure a property. the bids are propor  tional to their income.  4. the sellers determine the price they ask by employing an aspiration level heuristic.  5. at each location, buyers and sellers are matched through a continuous double auction. the transaction price is a  weighted average of the bid and ask prices. the weight depends on the bargaining power.  6. successful buyers take residence in the location where they searched and successful sellers leave the city. the market  price is computed at each location as the average price of the transactions that occurred there.  the goal of this paper is to introduce a baseline abm of the housing market, in which realistic behavioral rules give rise  to a variety of phenomena related to income inequality and income segregation. therefore we simplify many aspects of the  model, which is also necessary to keep the abm partly analytically tractable. while describing the model, we highlight a  number of possible modi cations that would improve the realism of the abm. most importantly, in this paper we only focus  on steady states o u r model describes what would happen to the spatial price distribution and income segregation patterns  in the long run, if the current state of the city was to persist.  2.1. space and time  the city is de ned as a two dimensional square grid omega1of locations x z 2 , with linear size l . the origin o is taken as  the geographical center of the city, and two neighboring locations are separated by a distance a . the same number n of  identical dwellings 5 are available at each location x omega1. time is discrete and indexed by t . the time horizon is in nite.  all locations are characterized by an attractiveness a . this combines a constant and exogenous intrinsic attrac  tiveness a 0 and an endogenous social component a s . the intrinsic attractiveness quanti es the presence of natu  ral amenities, historic buildings, and the convenience of the transportation system at that location. 6 the social component  quanti es the educational and labor opportunities that arise from living in that neighborhood . these in turn  depend on the average income of the agents living in that neighborhood, so we assume that a s y y , where  y is the average income of the agents living at location x at time t , and y is the average income of the agents in the  city at the same time step. we nally assume that the intrinsic and social components combine multiplicatively, namely  a a 0 a s .  one remark is important here. for simplicity in this paper we only consider a monocentric city where the intrinsic at  tractiveness a 0 decreases with the distance from the center . as we will see, this creates a positive  feedback by which rich agents take residence in the center and further increase the total attractiveness a there through  an increase of the social component a s . 7 this captures the idea of a city where most amenities and job opportuni  ties are concentrated in the center , also normally called central business district in urban  economics . by tuning a 0 , our abm trivially generalizes to cities with arbitrarily distributed attractiveness   a s in fig. 1 including polycentric cities , cities where the  rich choose to live in the peripheries , or cities with any other shape as studied in urban geography and city  planning .  2.2. agents  the agents are households. at each time step t a constant number gamma1of households arrive on the market from outside  the city and try to purchase one property. we refer to these agents as the buyers . these households are only characterized  by their monthly income y . for simplicity, we consider a nite number k of income levels. agents with the same income are  denoted by k agents, k 1 , . . . , k , and have income y k . these incomes are ordered by increasing values, y 1 y 2 . . . y k ,  and are separated by a constant delta1. we denote the number of incoming agents in each income category by gamma1k , s.t. summationtext  k gamma1k   gamma1.  at the end of each time step, some of the buyers secure a property and take residence in the city w e refer to these  agents as housed . we assume that the unsuccessful buyers leave the city and may come back with a subsequent cohort.  indeed, it is not useful to keep track of the identities of the buyers, as these agents are only characterized by their income.  at the beginning of each time step, households already living in the city may put their dwelling on sale with a constant  and homogeneous probability . housed agents whose dwelling is on the market are denoted as sellers . the sum of  5 housing market segmentation can be important . moreover, apartments are at least heterogeneous for what  concerns their size. we experimented with heterogeneous size and only found a blurring of the segregation patterns. for instance, assuming that with  homogeneous size the rich are completely segregated in the center, with heterogenous size a few low income households afford to reside in the center in  small apartments.  6 the typical way to include transportation into urban economics models is through a cost that is included in the budget constraint .  however, especially in european cities, transportation costs are relatively small, and so we model the commuting time as a disutility i n particular as a  negative effect on the attractiveness. gaign et al. show that amenities and commuting costs can be  aggregated into a single quantity, which they name the location quality index .  7 within our model the social component has a minor effect with respect to the intrinsic component. see section 4.1 . 20 m. pangallo, j. p. nadal and a. vignes journal of economic behavior and organization 159 15 35  buyers, sellers and housed agents is constant and equal to gamma1 nl 2 . at t 0 , all agents in the city are housed. when t 0,  the relative proportion of housed and sellers depends on the number of buyers gamma1, on the sale probability and on the  market outcomes.  in this model gamma1and are xed, but it could be useful to make them depend on the level of the prices in the city and  on the timing with respect to the house price cycle. for instance, could be larger if the prices are rising and smaller if the  prices are falling. however, being primarily concerned with income segregation, we are mostly interested in the long term  trends and the relative prices between several areas of the city, which are in uenced more strongly by the attractiveness  than by the global demand or leave rate.  2.3. demand  at each time step t , demand at each location x is determined by the individual decisions of the buyers. the k buyers have  utility function u k z k 1 , where z k represents the monthly non housing consumption of k agents at  time t . the parameter 0, 1 is the  weight given to the attractiveness, which exempli es housing consumption. the budget constraint is  z k p y k ,  where p is the expected monthly mortgage repayment after purchasing a property at location x and time t will be explained at the end of section 2 . we have also assumed unit cost for the non housing  consumption good, which is the num raire of the economy. the  above equation does not assume savings. if we wanted to include savings, we could just consider that the buyers spend a  fraction s of their income y k , and rede ne the incomes in the model as the part that is not saved. replacing the budget  constraint in the utility function, we get the indirect utility  v k braceleftbigg  1 , y k p ,  0 , y k p .  in case y k p the k agents cannot afford to purchase a property at location x and time t , and so their utility would be  0. note that this is not an indirect utility function standard in microeconomics . the reason is  that a is not a good whose quantity to be purchased is determined optimally, but rather a xed quantity that is taken  as given.  we consider a probabilistic model for the choice of residential location by the buyers. the k buyers choose location x at  time t with probability k , proportional to the utility they expect to nd at that location   k v k summationdisplay  x prime omega1v k .  this behavioral rule follows the literature on discrete choice theory , and captures the idea that the  decisions of the buyers are noisy, although not irrational. 8  to sum up, the demand side of the market at location x and time t is characterized by the number of k buyers  n k  b , k determined stochastically from eq. a n d by their reservation demand price, which we simply assume  to be a multiple of their monthly income p d  k y k . the reservation demand price is the maximum amount the buyers are  willing to bid. so they may potentially borrow an amount y k from a bank, and repay it monthly in installments. for  clarity of exposition, we will consider 1 , but this is equivalent to normalizing all prices to their monthly equivalent.  2.4. supply  the dwellings available for sale at location x and time t are those that are put on the market by the agents housed in  x in the same time step plus, if any, those that have not yet been sold on previous time steps. we denote the number of  sellers as n s .  the reservation offer price is the minimum amount a seller is willing to accept to sell his property. the sellers determine  their reservation price by employing an aspiration level heuristic . this concept was initially proposed by simon , who  in fact speci cally considered the example of an individual trying to sell a dwelling. the seller would accept any offer above  a satis cing threshold, and adjust that threshold downward if the sale was unsuccessful. search theory has developed this  idea by endogenizing the threshold and the waiting time so to follow an optimal stopping rule. a rich literature has applied  this idea to model the time on market of real estate properties.  most models in search theory assume that the sellers know the distribution of offers by the potential buyers. in real  housing markets information is limited and dispersed, and in our model there is an inherent stochasticity due to the noisy  decisions of the buyers. anenberg introduces a model in which sellers update their reservation price using bayesian  8 typically, in discrete choice theory the probability k depends exponentially on the utility v k , with a sensitivity parameter t h e intensity of  choice t h a t quanti es the deviation from rationality. here we choose a polynomial form of degree one, which is a more parsimonious parametrization. m. pangallo, j. p. nadal and a. vignes journal of economic behavior and organization 159 15 35 21  learning on the received offers, so to behave optimally given the available information. however, in uncertain environ  ments the use of simple heuristics in place of optimization can be optimal. therefore, following the fast and frugal heuristics  paradigm proposed by gigerenzer and todd , we assume that the sellers employ a xed selling rule, without an ex  plicit attempt to optimize pro ts. in particular, they try to apply a markup on the market price, and progressively reduce  their reservation price as their sale is unsuccessful. artinger and gigerenzer show empirically that most sellers indeed  follow this behavioral rule, which yields more pro ts than equilibrium strategies. 9  we follow artinger and gigerenzer in specifying the functional form of the aspiration level heuristic. sellers rst  attempt to sell at a higher price than the market price, trying to apply a markup on the current market price. if the sellers  are unsuccessful in selling after time steps, they adjust their reservation price downward by a factor . here captures  the downward stickiness typical of housing market when demand increases, prices rise quickly, but in situations of excess  supply prices decrease slowly. in formula, the reservation offer price p s  i for seller i at location x at time t is  p s  i p m , with m t t i ,  where t i is the time step in which household i put their apartment on sale, and t t i is the time on market. the reservation  price is decreased by a factor every multiple m of . note that differently from the case of the buyers h e r e we need  to keep track of the identities of all sellers i , as all reservation offer prices can potentially be heterogeneous. 10  2.5. matching  matching between buyers and sellers occurs at each location and each time step through a continuous double auction,  which we take as a stylized model of a bilateral bargaining process. the reservation offer prices enter in a random  sequence as asks in a limit order book. every time a bid price exceeds an ask price, a transaction takes place and the  two prices are removed from the order book. this process continues until all agents have placed their orders.  the price of the transaction depends on bargaining, which we model in a stylized fashion. in particular, we assume that  the price of a transaction between a k buyer and seller i is a linear combination of the reservation prices,  p ki p d  k p s  i .  here quanti es the bargaining power of the seller. if 0 , the transaction price is simply the reservation price of the  seller this parameterization would model a situation in which the seller needs to post his reservation price while if   0 the seller would post a higher price.  finally, the market price p is the average of all transaction prices that were recorded at location x and time t .  3. mathematical analysis  the goal of this section is to show that, in spite of the complexity of the abm, some of its features can be understood  analytically, without the need to resort to numerical simulations. our analytical solution gives insights on the causal mech  anisms of the abm and makes the effect of its parameters clearer. while our mathematical analysis gives some insights into  the determinants of segregation, the reader who is mostly interested about the relation between segregation and income  inequality and in the effect of subsidies and taxes may skip this section, and move to the numerical simulations that follow  in section 4 .  for our analysis we follow a modular strategy, in the sense that we progressively focus on speci c aspects of the abm  while neglecting other features in order to maintain tractability. in particular, in section 3.2 we assume that the agents  only value the attractiveness in their utility function and we consider only one income category . in section 3.3 we relax the assumption that 1 , and focus on the tradeoff between non housing consumption  and attractiveness. in section 3.4 we consider two income categories and study the conditions that imply income  segregation.  in this section we only report the details necessary to understand the mathematical analysis, while leaving some techni  cal derivations to appendix b .  3.1. preliminary steps  the following simplifying assumptions are made for analytical tractability. these simpli cations are then relaxed in the  numerical simulations.  9 the authors actually consider the used cars market and not the housing market, but the information structure is quite similar in the two settings.  10 here we do not assume heterogeneity in the parameters , and . we do so for various reasons. on a practical note, we experimented with having  these parameters drawn from a distribution and virtually nothing changed at the aggregate level. as we aim to keep our model as parsimonious and  tractable as possible, it makes sense to just assume homogeneity of these parameters. on a theoretical note, artinger and gigerenzer show in their  figure iii that the distribution of these parameters is rather peaked around the median values in the used  cars market they analyze, and we think that this may also apply in the housing market. 22 m. pangallo, j. p. nadal and a. vignes journal of economic behavior and organization 159 15 35  first, we average out stochastic effects by taking expected values. for example, although the number of buyers coming  to each location x is given in the abm by a multinomial stochastic process with probabilities de ned in eq. , for the  mathematical analysis we assume that the number of buyers at x is the expected value of the process.  second, we assume continuous space by considering a vanishing distance between locations, a 0. this step requires an  important technical attention. so far all quantities were de ned for each location x e . g . the number of k buyers at x was  n k  b . in order to take the continuum limit we cannot keep using this de nition. indeed, when a 0 and l is xed the  number of locations grows large, so for example the number of k buyers in any speci c x would become vanishingly  small . we solve this technical issue by dividing all quantities that are de ned at the  location level by the local area a 2 . these quantities are now mathematically de ned as densities , and we denote them by a  lower case letter. for example the density of k buyers at x and t is n k  b n k  b a 2 . when a 0, also n k  b 0 ,  and so the density is well de ned in the limit. the other variables we have to transform are n s n s n s a 2  and n n n a 2 , where n n is uniform for all x .  third, we neglect the social component of the attractiveness, making the attractiveness time independent a a .  this is exact in the case of one income category, because all agents have the same income and so y y and  a a 0 . 11 we further assume that the intrinsic component of the attractiveness has circular symme  try and decreases with the distance r from the center o , up to a radius r max that represents the borders  of the city. therefore, we can write the attractiveness as a , with a prime 0. a possible speci cation of a is  a braceleftbigg e r 2  r 2 , 0 r r max ,  0 , r r max ,  where r is a steepness parameter that quanti es how much the attractiveness is concentrated in the center. 12 if r is very  small, only the center is very attractive and the peripheries are not attractive if r is large, the attractiveness is spread  evenly across the city. r max is chosen so that the areas of the discrete space square lattice omega1and its continuous space  circular approximation considered in eq. are the same, that is r 2  max l 2 . in order to emphasize that the results that  follow do not depend on the speci c form of the attractiveness in eq. , we write in general a , except when performing  speci c calculations.  finally, we focus on the steady state of the model. as already mentioned, our abm determines the economic outcomes in  the long run, if the current state of the city was to persist. it then makes sense to consider time averages in the numerical  simulations, and we will show that these closely match the analytical steady states.  3.2. baseline case  here we only consider one income category. we also assume that buyers only value the attractiveness in their utility  function . we only sketch the derivation and discuss which assumptions  are made, while the full derivation is given in appendix b.1 .  our rst step is to compute the densities of buyers and sellers at any distance r in the steady state. calculating the  density of buyers is trivial, as it only depends on the attractiveness which is exogenous in the simpli cation considered in  this section. calculating the density of sellers is instead tricky, because it depends on how many dwellings have remained on  sale from the previous time step. it is possible to nd a self consistent expression for this density for locations at distance  r if one assumes that all buyers were successful in securing an apartment at the same locations in the previous time step.  as we will see, breaking of this condition leads to inconsistencies and gives insights into the functioning of the model. the  second step of our derivation involves computing the reservation prices of buyers and sellers. all buyers have the same  reservation price w e are assuming only one income category. we calculate the expected reservation price of the sellers  given the expected time it takes to sell a dwelling at a location at distance r . we nally compute the market price as a  weighted average of the reservation prices of buyers and sellers.  the steady state market price p at distance r reads  p y parenleftbig n 1   gamma1a  z 1 parenleftbig n gamma1  a  z parenrightbig parenrightbig  parenleftbig n 1   gamma1a  z 1 parenleftbig n gamma1  a  z parenrightbig parenrightbig  gamma1a  z ,  where z 2 integraltext r max  0 r a dr is a normalization factor. as mentioned above, this expression is correct provided that all buyers  are always successful in securing an apartment, which in turn depends on two conditions being satis ed  n  b  n  s 1 and p y.  11 we will also show that ignoring the social component is safe in the case of two income categories too, at least within our mathematical analysis .  12 here r plays the same role as the intensity of choice in discrete choice models. this is another reason why we choose the polynomial form in  eq. instead of the more common logit form. m. pangallo, j. p. nadal and a. vignes journal of economic behavior and organization 159 15 35 23  fig. 2. analytical results with one income category. comparison between the analytical solution and the numerical simulations , in the  baseline case where 1 . the analytical prices are from eq. , setting p y near the center where the conditions are not satis ed. the numerical  results are averaged over 100 time steps over all locations at the same distance r , after an equilibration time of  50 time steps. we do not report standard errors on the numerical results because our model is ergodic and gives virtually identical results for different  random seeds. effect of 0, 1 . the prices are more uniform if is small, i.e. agents substitute housing with non housing consumption. the other  parameters are speci ed in appendix c .  the rst condition means that there must be at most as many buyers as sellers the second conditions states that the market  price must be smaller than the income of the buyers. we now look at three limiting cases that are interesting in their own  right and in which the conditions may or may not be satis ed. this also gives insights on the mechanisms of the model.  attractiveness. we consider the least attractive locations, in which almost no buyers purchase any property. from  eq. , lim a z 0 p y . the reservation prices of the sellers drop to zero because the time on market grows to in n  ity. so from eq. the market price is simply determined by the bargaining parameter and by the reservation price of  the buyers y . the conditions are satis ed.  tightness. we consider some attractive location in which the number of buyers equals the number of sellers i n other  words the demand tightness q n  b n  s 1 . we have lim q 1 p y . the expression for the market  price simpli es considerably. however, it is possible to check that y y, which is inconsistent with  the assumptions of the model . this is easily explained in dynamical terms.  suppose that at time t the price is p y . the buyers bid y , while the sellers ask p . so the price at time t 1 is  p prime y p p . the sellers immediately sell their property, so their reservation offer price has no time to  decrease, therefore a steady state cannot be reached as the market price keeps increasing.  stickiness. we now assume that the prices are extremely sticky, in the sense that the discount factor of the sellers 1  is close to unity. in the limit, lim 1 1 p y . the outcome is the same as for q 1. indeed, the  dynamics are similar. assume that the agents put their dwelling on sale at t , when the price is p . at t prime greatermucht they still ask   p, and so the market price at r keeps increasing and cannot reach a steady state. note that in eq. , and occur  as a combination of parameters, 1 . they are effectively only one parameter, as it is enough to vary one while holding the  other xed.  given the above analysis, we impose the constraint that if p y , we set p y . this constraint simply formalizes  the idea that the buyers cannot bid more than y , and so the market price cannot be higher.  as can be seen in fig. 2 a, the mathematical results are in line with the numerical simulations of the discrete space and  fully heterogeneous dynamics. the prices are slightly overestimated by the mathematical analysis. this is because of the  order book dynamics. sellers with a lower reservation price have higher chance of selling, but this effect is not captured in  our mathematical analysis as we assume that all dwellings on the market at r are sold with the same probability.  3.3. general utility  in general, the utility function for k buyers for choosing a location at distance r from the center at time t is  u k z k 1 ,  where 0 1. since just the utility function is different from the previous section, the analysis is similar. . as can be seen in fig. 2 b, for small values of the prices are almost uniform  across the city, due to the substitution effect between housing and non housing consumption, whereas larger values of  increase the slope of the price gradient.  3.4. two categories  now we keep 1 and consider two income categories, k 2 . the income levels of agents are y 1 and y 2 , with y 2  y 1 delta1. we denote the households respectively as 1 agents and 2 agents t h e poor and the rich respectively. we study under 24 m. pangallo, j. p. nadal and a. vignes journal of economic behavior and organization 159 15 35  fig. 3. size of the segregated region as a function of some parameters. we plot the radius of the segregated region r s against three parameters.  we compare the analytical results with numerical results . in the numerical approximation we cannot have total segregation because of  stochastic effects, so we de ne r s as the rst distance at which the share of 2 agents is smaller than 95 . r quanti es how evenly spread is the attractiveness. delta1 y 1 is the relative spread of the income levels. 1 is the  stickiness of the prices. the other parameters are speci ed in appendix c .  which conditions the market mechanism implies income segregation. under the assumptions made in this section, the best  way to determine this is to check if there exists a completely segregated circle with center o and radius r s 0 , r max , which  is only inhabited by 2 agents. in this circle the steady state value for the market price must be higher than the income level  of the 1 agents, formally p y 1 , r r s . since the circle is inhabited only by 2 agents, we can use the one category result  in eq. with y y 2 and gamma1 gamma12 . rearranging the boundary condition p y 1 , and considering the speci c form of the  attractiveness as in eq. , we can compute r s , the radius of the segregated region  r s r radicalbigg  log gamma12 bracketleftbig1  1 delta1 y 1 parenleftbig1   parenleftbig 1 1 parenrightbig  parenrightbig    parenleftbig 1 1 parenrightbig bracketrightbig  r 2 parenleftbig 1 e r 2  max r 2 parenrightbig n parenleftbig 1 1 parenrightbig1 delta1 y 1  1 delta1 y 1 .  we can then study the effect of the parameters on r s . the radius of the segregated region increases with the number  of incoming high income households gamma12 , and with the markup that the sellers try to apply. indeed, gamma12 is only in the  numerator and multiplies the squared brackets, and is only in the numerator and provides a non negative contribution.  on the contrary, the radius r s decreases with the number of available apartments n which is only in the denominator ,  supporting the policy that fewer regulatory constraints on constructions may alleviate income segregation. the role of the  other parameters cannot be immediately seen from eq. , so in fig. 3 we plot the radius of the segregated region as a  function of a few interesting parameters.  in fig. 3 a we consider r , the scale factor of the exponential in eq. that quanti es how evenly spread is the attrac  tiveness. interestingly, as r increases there is a non monotonic effect. when r is small , all 2 buyers  want to reside in the center and this keeps the prices above the income level y 1 of the 1 agents. the radius r s grows with r ,  because the 2 buyers spread in a larger region. but after a turning point, r s starts decreasing, because the 2 buyers spread  more and more evenly and are not numerous enough at any speci c location to keep the prices above y 1 . this result is in  line with gaign et al. , who nd that a multimodal distribution of amenities may foster social mixing. in fig. 3 b we  look at delta1 y 1 , that quanti es the relative spread of income levels. these parameters always occur as a ratio of one another,  suggesting that they can be treated as a unique parameter. a larger delta1 y 1 slightly increases segregation, almost in a linear  fashion. finally, in fig. 3 c we show that more stickiness leads to more segregation. there is an asymptote at 1 1, in  which the reservation offer prices never decrease, as discussed in section 3.2 .  in all the cases above analytical results match numerical results well, indicating that in this case it is safe ignoring the  social component of the attractiveness .  4. numerical simulations  in this section we perform some numerical simulations of the fully edged abm to analyze the effect of the income  distribution and of subsidies and taxes on the prices and segregation patterns. we consider ten income categories, k 10 ,  and we assume that agents face a tradeoff between housing and non housing consumption . the other values for  the baseline parameters are discussed in appendix c . we set some parameters following guidance from the mathematical  analysis, and set other parameters to empirically reasonable values.  the cost of considering a more realistic setting is that no analytical solution is possible. to ensure full reproducibility,  the code used to generate all gures is available at https dx.doi.org 10.5281 zenodo.1453347 . m. pangallo, j. p. nadal and a. vignes journal of economic behavior and organization 159 15 35 25  4.1. dynamics of the agent based model  we perform our analysis by averaging variables over time. indeed, as already mentioned we are interested in long term  trends and segregation patterns, so it makes sense to ignore high frequency uctuations. moreover, in this section we show  that at least some variables quickly reach a steady state punctuated by noise. other variables display larger uctuations but  these are mostly driven by noise. the lack of economically meaningful endogenous dynamics in our model further justi es  taking time averages.  in fig. 4 a we show the time evolution of the market price at three locations. at x and x the market  price reaches a relatively stable value after about 25 time steps, after which the uctuations are typically around 5 price  units. the market price at x reaches a similar state, but the transient is longer, of the order of 75 time steps.  unsurprisingly, the market price is highest in the center, where the attractiveness is maximal, and decreases moving farther  from the center.  the dynamics of the attractiveness is shown in panel b of the same gure. at initialization , the agents are allo  cated randomly across the city, irrespective of their income category. therefore, up to noise the average income y at  any location x is equal to the average income over the city y . this means that the social component of the attractiveness  is a s 1 , so at initialization the attractiveness a approximately corresponds to the intrinsic compo  nent, a a 0 . as the social composition of neighborhoods changes over time, so does the attractiveness. at x  it raises steadily from a 1 to a 1.4, while at x the attractiveness also rises but by a smaller  amount. in both locations the increase of a is explained by the share of rich agents increasing over time,  creating a positive feedback that further increases the share of rich agents. the opposite mechanism is at play at x ,  where the share of rich agents decreases over time. is two orders of magnitude smaller  than at x , for visualization purposes we show the attractiveness at x on the right scale of the vertical axis.  in all cases, the social attractiveness quantitatively plays a minor role with respect to the intrinsic attractiveness.  a more detailed representation of the evolution of the social composition of neighborhoods is given in fig. 4 c. we show  the number of agents whose status is either housed or seller and belonging to three income categories, in the same three  locations as above. at x the poorest of the three categories disappears after 50 time steps, because  the market price becomes larger than their income y 3 . the number of agents belonging to the two other categories instead uctuates over time. these numbers also uctuate at x and x   , with the share of 3 agents increasing as one moves farther from the center.  finally, in fig. 5 we show the time averaged shares of k agents as a function of the distance from the center. this gure shows that the categories  with lowest income are segregated out of the center, while agents from the other categories are mostly located up  to distance r 4 . however, the shares of k buyers at locations r 4 are not proportional to the population shares. for  example, at r 0 the share of 10 agents is roughly 1 3 of the share of 4 agents, but in the population of buyers gamma110 gamma14 1 5  , so 10 agents are over represented in the center. this is caused by the continuous double auction although  the market price is below the reservation price of 4 buyers, 10 buyers bid higher and are matched rst. because in the very  center demand largely exceeds supply, 10 agents are more likely to secure an apartment. 13  4.2. effect of the income distribution  we now study the effect of the income distribution of the buyers on the prices and segregation patterns. we consider  twelve income distributions, with increasing levels of inequality. we keep the shares of k buyers gamma1k gamma1 xed, and vary in  stead the minimum income y 1 and the total income spread delta1. indeed, buyers categories are arbitrarily de ned, and it is the  relative income spread delta1 y 1 that determines the level of inequality . the important constraint is that the total  income of the buyers must be the same across income distributions to allow for a meaningful comparison.  the total income of the buyers is  m k summationdisplay  k 1 y k gamma1k y 1 gamma1 delta1k summationdisplay  k 2 gamma1k gamma1 bracketleftbigg  y 1 delta1k summationdisplay  k 2 gamma1k gamma1 bracketrightbigg  .  in order to quantify income inequality, we take one of the possible de nitions of the gini index, namely half the relative  absolute mean difference of incomes . with the discrete distribution we consider, the gini index reads  g summationtext k  k 1 gamma1k summationtext k  j 1 delta1 k j gamma1j  2 gamma1m .  we keep m 60 gamma1and x the shares of k buyers to gamma1k gamma1 . we then  vary delta1and y 1 to obtain twelve different income distributions, whose gini coe cients range from g 0 . 26 to g 0 . 48 . for  example, the most equal income distribution is characterized by y 1 30 and delta1 11 . 86 , so the relative income  13 the over representation is also partly caused by a substitution effect 4 buyers would spend most of their income to live at r 0 , so they prefer  neighborhoods farther from the center where they can afford a higher level of non housing consumption. 26 m. pangallo, j. p. nadal and a. vignes journal of economic behavior and organization 159 15 35  fig. 4. dynamics of the agent based model. we plot some variables over time at three locations representative of the city. x is the center  , x is in the periphery , x is in between . we only show one simulation run, but the time series are  qualitatively similar for other random seeds. here y 1 30 and delta1 11 . 86 , the other parameters are speci ed in appendix c . the market price quickly  reaches a steady state punctuated by noise. the attractiveness a also reaches a similar state. at x and  it increases from the initial intrinsic value a 0 , whereas at x it decreases. number of agents with k 3 , k 5 and k 8   at the three locations.  fig. 5. spatial distribution of k agents as a function of the distance from the center. the parameter values are the same as in fig. 4 . the number of  k agents is averaged over 100 time steps over all locations at the same distance from the center.  spread is only delta1 y 1 0 . 4 and the income of the richest buyers is larger by a factor of 4.5 than the income of the poorest.  conversely, the most unequal income distribution has y 1 5 and delta1 21 . 74 , so delta1 y 1 4 . 35 and the richest  buyers have 40 times the income of the poorest. all values of delta1, y 1 and g are speci ed in appendix c .  it is not meaningful to compare different income distributions by considering the spatial distribution of the shares of k  agents . indeed, these categories are arbitrarily de ned and we need to measure segregation in a way that is in  dependent of the level of inequality. therefore we resort to a rank order information theory index  which only uses information about the rank ordering of incomes, and is thus independent of the income distribution. we m. pangallo, j. p. nadal and a. vignes journal of economic behavior and organization 159 15 35 27  denote income percentile ranks by p 0, 1 . for any given value of p , we calculate the segregation over the city between  households with income ranks less than p and households with income ranks greater or equal to p . we then average over  all values of p . more speci cally, denote by  e p log 2 p log 2  the information entropy of the population when divided into these two groups, and by  h 1 1  l 2 summationdisplay  x omega1e x  e  the theil index of segregation in the population divided between these two groups, where e x is the information entropy  calculated at location x . the rank order information theory index h r is then  h r 2 ln 2 integraldisplay 1  0 e h dp  this quantity varies between a minimum of zero, which corresponds to complete lack of segregation e , x omega1 , and a maximum of one with  complete income segregation .  in fig. 6 a we show how the segregation index h r varies with the level of inequality, as measured by the gini index.  we see that segregation increases with inequality, most strongly for g 0.38. there is little empirical evidence on the effect  of income inequality on income segregation, because spatial income data are rarely available. most studies rely on u.s. census data, because binned income distributions   are available for each census tract. these studies nd that income inequality increases income segregation,  in accordance with our model. reardon and bischoff attribute this result to income correlated social preferences, or  to higher provision of local public goods in neighborhoods where the rich live . here we show that our abm  can replicate this nding.  we look at the spatial distribution of prices in fig. 6 b. comparing the most unequal and the most equal income dis  tributions, in the unequal case the prices are higher in center and lower in the peripheries. indeed, in the outskirts the  share of lowest income households is larger if the income distribution is unequal, reducing the prices. because most agents  reside in the locations where the prices go down, the global effect on prices is negative . this result is in line with  m tt nen and tervi , who come to the same conclusion using an assignment model that determines an equilibrium  price gradient . the authors also show that this nding is supported empirically in a number of u.s. cities. using their model,  they perform a counterfactual exercise and calculate what the prices would be if the level of inequality had not increased.  they nd values between 0 and 10 higher according to the speci c metropolitan area, in quantitative accordance with our  model.  we also experiment with an additional in ux of rich agents in the center, testing whether the prices only grow in  this location or whether they increase all over the city. we mimic the process by which rich households coming from  outside t h e foreigners purchase real estate properties in a city, either as a luxury good or as a secondary residence  . 14 these buyers usually choose the most attractive locations, and distort the local housing  market because of their disproportionately high reservation prices .  we assume that gamma1 10 foreigners try to purchase a property at any time step t 0 with uniform probability in all  locations within a radius r 3 from the origin o , i.e. x z 2 s.t. x 2 y 2 9 . we impose this hard threshold because  we will assess whether prices and segregation patterns change all over the city and not just in the center. therefore, we  need to exclude the trivial scenario in which foreigners directly affect these variables by searching all over the city. the  income of the foreigners is y k delta1, that is larger by a factor of delta1than the income of the k agents. other than that, the  foreigners participate to the housing market following the same protocol as the other agents, e.g. they are not necessarily  matched rst in the order book.  we consider the most equal income distribution as a benchmark . fig. 6 b shows that the prices increase substantially in the area where the foreigners search, but also all over the  city, especially in the peripheries. the arrival of foreigners in the center leads to price growth in the most attractive loca  tions. in turn, the increase in prices makes these locations less appealing to high income households. indeed, recall from  section 2.3 that households also value non housing consumption, and so are willing to substitute the attractiveness for  cheaper locations where they can afford a higher consumption level. as the high income households move to less attractive  locations, their bids push up the prices there as well. so middle income households may decide to search in the least attrac  tive locations, and the process cascades all over the city in the steady state. this implies that 1 agents  cannot afford buying properties even in the peripheries and are segregated out of the city, differently from the benchmark  case without additional in ux in fig. 5 .  14 another important category of wealthy external buyers is investors, who are mostly driven by interest and exchange rates and by home market condi  tions . as already mentioned, in this paper we focus on long term outcomes. because investor dynamics is highly volatile  we do not think of agents composing the additional in ux of buyers as investors. 28 m. pangallo, j. p. nadal and a. vignes journal of economic behavior and organization 159 15 35  these conclusions are supported by indirect empirical evidence. for example, cvijanovic and spaenjers analyze  the purchases of foreigners in the paris housing market and show that foreigners crowd out residents, overpay and cause  prices to increase in the most attractive locations. s nds that foreign investment in england and wales has a  positive causal effect on house price growth at different percentiles of the distribution, but she does not consider the spatial  aspect. from a theoretical point of view, favilukis and van nieuwerburgh come to our same conclusions. they use an  overlapping generations model in which heterogeneous households decide consumption, savings, labor supply, tenure status,  and location. in equilibrium, the households anticipate the arrival of the foreigners , and adjust  their decisions accordingly.  4.3. effect of subsidies and taxes  we investigate which policy is most effective at reducing income segregation and increasing social welfare. housing  market policies have traditionally been divided in two strands.  first, subsidized housing aims at improving the accessibility of low income households to the housing market. there are  two types of subsidies project based and tenant or buyer based . the former include public  housing and subsidies to the construction sector, which is incentivized to construct new affordable houses. the latter in  clude buyer based vouchers, certi cates, rent supplements etc. there is a strong consensus in the literature for buyer based  subsidies , and so we focus on this policy .  second, transaction taxes increase the cost of transacting a dwelling. to avoid paying the tax, many households may post  pone buying or selling a dwelling , or adjust the transaction price to exploit discontinuities in tax liability  . for our purposes, transaction taxes are also aimed at cooling the housing market and therefore  improve affordability for low income households, as con rmed by the recent 15 transaction tax on foreign purchases in  vancouver. 15 transaction taxes can be on buyers or on sellers . we focus  here on transaction taxes on buyers, which are widespread in oecd countries .  we implement a system of ad valorem taxes and subsidies on buyers in a stylized fashion. we denote by k the tax or  subsidy for k agents, where k 0 indicates a tax, and k 0 denotes a subsidy. for example, a 10 subsidy corresponds to   k 0 . 1 , and a 10 tax to k 0 . 1 . the budget constraint of the buyers becomes z k p y k . replacing the  budget constraint in the utility function, we get the indirect utility  v  k p 1 .  the reservation demand prices are also affected by the tax or subsidy, with p d  k y k . for instance, with a 10 subsidy,  the purchasing power of agents with income y 15 rises to y 0 . 9 16 . 7 . on the contrary, with a 10 tax, the purchasing  power of agents with the same income reduces to y 1 1 . 1 13 . 6 .  we analyze the effect of three policies on the prices and segregation patterns, and compare with the no policy bench  mark. the magnitude of subsidies and taxes should not be taken literally, as we are interested in qualitative differences and  are not calibrating the model against real data. the policies are   subsidies only s . 1 agents receive a 20 subsidy, 2  agents receive a 15 subsidy, etc.   taxes only t . we implement an income dependent transac  tion tax, with 10 agents paying 20 of the transaction price, 9 agents paying 15 , etc.   subsidies and taxes st . we combine the systems of taxes  and subsidies. with this policy subsidies are funded through transaction taxes.  fig. 7 illustrates the results of our policy exercise. in fig. 7 a we see that taxes have a very small effect in mitigating in  come segregation, whereas subsidies are more effective .  the effect of policies is more pronounced if the level of income inequality is not too high.  fig. 7 b shows the average market price for the various policies. in this model, taxes are not successful at decreasing the  prices. there are at least two reasons for this. first, the reservation prices of the richest buyers w h o are the ones mostly  affected by the taxes a r e still above the market price at any location, so the richest buyers do not pay a fundamentally  different price. second, because the global demand gamma1is assumed inelastic, taxes cannot crowd out rich buyers. fig. 7 b also  shows that subsidies increase the market price. however, the rise is included between 4 and 6 price units, whereas the  growth in purchasing power that the subsidies entail for the lowest income households is 7.5 price units . so subsidies make it possible for these households to afford properties in locations which they could not afford  without the policy.  so far we have only compared the different policies based on the effect they have on the segregation index h r and on  the market prices. we conclude this section by performing a welfare analysis of these policies. by changing the prices and  the social composition of neighborhoods, these policies impact the utility functions of all agents. the compensating variation  cv  k for k agents at location x due to the introduction of policy is the amount of money that the same agents would  15 see https www2.gov.bc.ca gov content taxes property taxes property transfer tax understand additional property transfer tax . m. pangallo, j. p. nadal and a. vignes journal of economic behavior and organization 159 15 35 29  fig. 6. effect of the income distribution on segregation and prices. rank order information theory segregation index h r as a function of  the gini index . higher inequality leads to more segregation, in accordance with empirical evidence. average market price for the most equal  and most unequal income distributions, and with an additional in ux of rich buyers who search for an apartment only in the center. in the latter case, the  prices increase all over the city and not only in the center. globally, the prices are lower if the income distribution is unequal.  fig. 7. effect of subsidies and taxes on segregation and prices . segregation as a  function of the level of inequality for the various policies. the no policy benchmark corresponds to fig. 6 a. average market price as a function of the  distance from the center for various policies and in the case of the most equal income distribution .  need to receive to return to the original utility level . denoting v 0  k , a as the indirect  utility for k agents at x without the introduction of the policy, the compensating variation is de ned by  v 0  k , a v  k parenleftbig y  k cv  k , p , a parenrightbig ,  where v  k , y  k , p and a denote the same variables with the introduction of the policy. note that the prices, the  attractiveness and also potentially the compensating variation should also depend on time. as we take time averages, to  simplify the notation we drop the time dependence.  solving eq. for cv  k using the usual form of the utility function and the usual speci cation of subsidies and taxes   yields  cv  k k p parenleftbig p p parenrightbig    parenleftbigg  y  y parenrightbigg  1   1   . 30 m. pangallo, j. p. nadal and a. vignes journal of economic behavior and organization 159 15 35  fig. 8. welfare effects of subsidies and taxes. the compensating variation is the amount of money that an agent should receive to maintain the  same utility level after the introduction of the policy. therefore, a positive cv is associated with a decrease in utility, while the opposite is true when the  cv is negative. the cv subsumes the different channels through which the policies impact the welfare of the agents , but it does not consider  the long term bene ts of social mixing. all policies increase the welfare of the agents with lowest income categories, at the cost of decreasing the welfare  of richer agents.  the three terms on the right hand side of the expression above clarify the channels through which the different policies  impact the welfare of the agents. the rst term is the amount of money necessary to compensate the increase  in purchasing power that the subsidy entails. indeed, when k 0 , this term is positive, while when k 0 this  term is negative . the second term is the difference in prices. when the prices increase, due to the introduction of the policy,  p p is positive and agents need to receive money to keep the same level of utility. if the prices decrease because  of the policy the opposite if true. finally, the third term is positive if y y 1 , i.e. if the policy reduces the average  income at location x . this implies a reduction in utility through the social component. an increase in average income would  instead increase utility and thus lead to a negative contribution in the compensating variation.  one thing that cv  k does not capture is the long term bene ts of social mixing . indeed, we do not  have a labor market or an educational system in our model, and the social composition of neighborhoods only enters utility  through the average income. therefore, we should expect that the compensating variation is overestimated in our analysis,  i.e. the decrease in welfare due to the various policies does not take into account the long term increase in welfare due to  a better functioning labor market and educational system.  in fig. 8 we show the compensating variation c v  k summationtext  x c v  k l 2 , averaged over all locations x , for k agents for policy   . in all cases this quantity is negative for agents belonging to the lowest income categories and positive for all other agents,  suggesting that only the welfare of the poorest agents improves. a utilitarian social welfare function assumes that social  welfare is just the sum of the welfare of all agents sw  u summationtext  k gamma1k cv  k gamma1. from a utilitarian point of view, the global welfare  would decrease due to the introduction of the various policies. according to a rawlsian welfare function sw  r min k cv  k  instead the global welfare improves, because the poorest agents are increasing their welfare.  5. conclusion  in this paper we have introduced a baseline agent based model of the housing market. our goal was to better  understand the relation between segregation and income inequality, house prices and policies by explicitly representing  the behavior of buyers and sellers and the market dynamics. in our model, the behavioral rules rely on discrete choice  theory and on the fast and frugal heuristics paradigm, and the price formation mechanism is represented using a continuous  double auction. we need not impose any equilibrium restriction because in the abm methodology outcomes are the result of unconstrained  interactions among agents.  we have found a partial analytical solution of the abm. from a methodological point of view, this shows that abms are  not incompatible with mathematical analyses, and that equilibrium and rationality are not simplifying assumptions neces  sary for mathematical tractability. our analytical solution makes it possible to analyze the structure of the model and the  effect of the parameters. for instance, a closed form solution shows that increasing the number of apartments available in  a city reduces income segregation.  we have simulated the model to study the interplay between the income distribution of the buyers and the spatial price  distribution, with a focus on segregation patterns. we have then analyzed the global effect of a demand spike localized in m. pangallo, j. p. nadal and a. vignes journal of economic behavior and organization 159 15 35 31  the center, and we have compared a number of policies whose goal is to foster social mixing. some of our results are in line  with other ndings in the literature, but our modeling methodology allows for a simpler narrative that directly matches the  housing market dynamics. other results account for previously unexplained empirical facts. for example, we are not aware  of any theoretical contribution that reproduces the positive causal link from income inequality to income segregation.  our model can be extended in several ways, depending on the research question. because of the enhanced exibility  implied by the lack of equilibrium constraints, it is extremely easy to add more realistic features . for example, we may endogenize the global demand and the leaving rate. coupled with a role for expectations,  this is likely to generate price cycles in the city. we can also endogenize the intrinsic attractiveness, e.g., to consider agglom  eration effects. we can nally model mortgages and a nancial sector, so to investigate whether there is any implication of  segregation on nancial stability.  more importantly, this paper has served as a qualitative demonstration that a disaggregated agent based representation  of the housing market can account for a wide range of both well known and less obvious phenomena related to income seg  regation. the next step to show that abms may be a more faithful representation of real housing markets would be to show that abms better predict prices and segregation patterns quantitatively  and out of sample. some works are starting to bring housing abms to data, but much  more work is necessary in this direction.  appendix a. odd d description of the agent based model  having a standard for describing agent based models makes comparisons across abms easier and helps re  searchers describe their models more clearly. to this end, grimm et al. proposed a protocol named overview, design  concepts and details , which was supplemented by m ller et al. to include human decision making . in this appendix we describe our abm following the odd d protocol.  a.1. overview  a.1.1. purpose  in this paper we introduce an abm of the housing market. the purpose of our abm is to understand phenomena related  to income inequality and income segregation and to study the effects of policies designed to tackle these. an abm is well  suited to this goal because it makes it easy to fully consider heterogeneity by modeling the market in a decentralized way  without imposing aggregate constraints such as equilibrium.  a.1.2. entities, state variables and scales  the agents in our model are households. they are mainly characterized by their state they can be buyers, sellers, or  housed if they are neither buying nor selling. agents are also characterized by their income. the exogenous driving factor  of our model is the structure of the city, here represented by an intrinsic attractiveness that subsumes amenities and the  convenience of the transportation system. this exogenous factor is supplemented by an endogenous social component that  depends on the social composition of neighborhoods. space is a grid of xed size with a nite number of locations. time is  discrete and the time horizon is in nite.  a.1.3. process overview and scheduling  at the beginning of each time step buyers come to the city from the outside and select a location in which they will  search for a dwelling. at the same time, housed agents may decide to put their dwelling on sale with a certain probability,  and join the set of sellers at the same location. next, at each location transactions take place mediated by a continuous  double auction. finally, successful buyers take residence in the location where they searched, successful sellers leave the  city and the updated market price is computed.  a.2. design concepts  a.2.1. theoretical and empirical background  our abm builds on a substantial body of work on abms of the housing market, and most of our assumptions are drawn  from the existing literature . with respect to many abms in this literature, we  designed our model to be parsimonious and tractable. the choice of the behavioral rules is based on the fast and frugal  heuristics paradigm . this suggests that in environments in which information is limited and  dispersed using simple heuristics may be optimal.  a.2.2. individual decision making  buyers select a location where they could search for a dwelling based on the expected utility at that location. however,  instead of maximizing their expected utility, they choose a location with a probability proportional to the utility, in the  same spirit as in discrete choice theory. sellers employ an aspiration level heuristic, by which they try to apply a markup  on the current market price and reduce their requested price successively if they fail to sell their dwelling. 32 m. pangallo, j. p. nadal and a. vignes journal of economic behavior and organization 159 15 35  a.2.3. learning  no learning takes place.  a.2.4. individual sensing  buyers are expected to know the market price and the attractiveness in each location, further to their own income. the  fact that they choose a location with a probability proportional to the expected utility at that location may include imperfect  measurement of the characteristics of a location b u y e r s may fail to choose the optimal location because they may have  limited information. sellers only need to know the market price of the location where they live at the time in which they  put their dwelling on sale.  a.2.5. individual prediction  the agents do not predict future conditions. expectations would be particularly important in case of speculation, but this  is not our focus here.  a.2.6. interaction  interactions between buyers and sellers are mediated by a continuous double auction. this is meant to represent bilateral  bargaining between two groups in a stylized fashion.  a.2.7. collectives  there are no collectives in this model.  a.2.8. heterogeneity  buyers are heterogeneous for what concerns their income. this impacts their decision making because poor households  will not attempt at purchasing properties in expensive neighborhoods. sellers are heterogeneous for what concerns their  reservation price sellers whose dwelling has been on the market for a long period will accept a lower reservation price.  a.2.9. stochasticity  initialization is completely random, but the model is ergodic so initialization does not matter. buyers search among  locations in a stochastic manner.  a.2.10. observation  we let the model run for an initial transient and then take measurements when it has reached the steady state. we  mostly measure prices and the number of agents who fall in distinct income categories in each location.  a.3. details  a.3.1. implementation details  the model has been implemented in netlogo . the netlogo code and the r code that runs the model  through the rnetlogo interface are available on zenodo https dx.doi.org 10.5281 zenodo.1453347 .  a.3.2. initialisation  all locations are initialized with a price that is below the minimum reservation price of the buyers. buyers with different  incomes are allocated randomly at initialization.  a.3.3. input data  the model does not take data from external sources.  a.3.4. submodels  for more details, we refer the reader to the code, and to appendix c for the parameter values and rationale for choosing  those values.  appendix b. mathematical derivations  b.1. derivation of the market price in the one category case  we proceed in three steps. first, we calculate the densities of buyers and sellers at any distance r , in the steady state.  second, we compute the average reservation demand and offer prices. third, we obtain the market price.  we start calculating the expected steady state densities of buyers and sellers at distance r . we denote them by n  b  and n  s respectively. the density of buyers is obtained multiplying the number of buyers gamma1by the probability density to  choose a location at r , given by the attractiveness a and by a normalization factor z  n  b gamma1a z, with z 2 integraldisplay r max  0 ra dr . m. pangallo, j. p. nadal and a. vignes journal of economic behavior and organization 159 15 35 33  the density of sellers n s can be computed by summing the density of apartments already on sale, denoted by n s ,  and the expected fraction of apartments newly put on sale n s n s . by de nition the apartments  already on sale at time t are those that were not sold at time t 1 .  in order to calculate n s we make the crucial assumption in this mathematical derivation, namely that all buyers at  location r and time t 1 succeed in securing an apartment. this assumption is correct only if two conditions are met. first,  the number of buyers must be smaller or equal than the number of sellers. second, all buyers must afford the dwellings,  that is the reservation demand price of all buyers must be larger than the reservation offer price of all sellers. the validity  of this assumption is checked ex post in the discussion in section 3.2 .  in any case, if all buyers secure an apartment, we have n s n s n b . in the steady state,  n  s n 1   n  b .  we now calculate the expected reservation prices. since there is only one income category, the reservation demand prices  are all identical, and correspond to y y 1 . on the contrary, the reservation offer prices are heterogeneous, because they  depend on the time on market . here we make a slightly simplifying assumption, namely that the sale probability is  the same for all dwellings on the market at location r , and therefore corresponds to the market tightness q n  b n  s . in fact,  cheaper dwellings are more likely to sell in the order book, but comparing to simulations in section 3.2 we show that this  is a second order effect.  using eq. , the expected steady state reservation offer price at a location at distance r is  e p s, p e t t i .  in the steady state, at each time step a dwelling on the market is sold with probability q , and not sold with probability  1 q . we can calculate the expected discount e k , with k t t i , by using the geometric distribution 16  e k summationdisplay  k 1 parenleftbig 1 parenrightbigk 1 k 1 q q  1 1 .  we can nally write the market price at distance r from the center, in the steady state. we use eqs. and and the  de nition of market price, that is a weighted average of the expected reservation and offer prices, with weight 0, 1  p y e p s, .  rearranging gives eq. .  b.2. details on the one category case with general utility  the xed point p has the same functional form as in eq. , except that the ratio a z is replaced by v z ,  where  v 1 ,  z 2 integraldisplay r max  0 w 1 dw .  the problem is that we cannot explicitly solve for p anymore, so we must use an iterative method. for each value  of , we start from the value of z that we observe in the simulations, and solve eq. z v z numerically for 10,0 0 0 values of r , 0 r r max . we then numerically compute z from eq. with the  trapezoidal method, and iterate this procedure until convergence for z is reached.  appendix c. parameter values  the baseline parameter values are reported in table 1 .  we discuss the calibration choices below   0 . 95 . merlo and ortalo magne analyze one of the most detailed datasets on listing price changes and offers  made between initial listing and sale agreement. they nd that, on average, the rst price reduction is 5.3 and the  second reduction is 4.4 . baptista et al. also use 0 . 95 , obtained from zoopla data . finally, loberto et al. also nd a similar value from the analysis of a  housing advertisements website in italy.  16 strictly speaking, the sellers decrease their reservation price at intervals of time steps, which is indeed what we do in the numerical simulations.  however, in the analytical solution we are implicitly assuming that they decrease the reservation price by a factor 1 every time step. 34 m. pangallo, j. p. nadal and a. vignes journal of economic behavior and organization 159 15 35  table 1  model parameters.  symbol value description  n 100 number of apartments at each location  l 11 linear size of the grid omega1 a 1 distance between neighboring locations  r 3 steepness parameter in the attractiveness  k 10 number of income categories  y 1 15 income of the lowest income category   delta1 5 difference in income between two consecutive categories   0.5 weight given to the attractiveness in the utility function   0.1 probability for housed agents to become sellers   0.1 markup that the sellers try to apply to the market price   0.95 discount rate on the reservation offer price   2 time steps of unsuccessful sale before price revision   0.1 bargaining power of the seller   gamma1 10 0 0 total number of incoming agents each time step  table 2  parameters de ning the income distribution.  minimum income y 1 income spread delta1gini index  30 11.86 0.26  28 12.65 0.28  26 13.44 0.30  23.5 14.43 0.32  21 15.41 0.34  19 16.21 0.36  16.5 17.19 0.38  14 18.18 0.40  12 18.97 0.42  10 19.76 0.44  7.5 20.75 0.46  5 21.74 0.48   gamma1 10 0 0 , n 10 0 , 0 . 1 . as shown in eq. , the price is determined by the relative magnitude  of these parameters. we chose these speci c values to have a reasonable level of noise. indeed, with too few agents the random arrival of buyers would generate wild price uctuations, and with too many agents the price dynamics would almost be deterministic. finally, note that in section 3 we have used   gamma1 400 for illustrative purposes.   0 . 5 . the households value housing and non housing consumption equally.   l 11 , r max 6 . 21 , r 3 , a 1 . the attractiveness decreases at r to approximately 1 3 of its value in the center. with  this choice, r is close to half the radius of the city. therefore, we have an attractive center and a non attractive periphery,  which is a necessary condition for price differentiation. l and a just determine the size of the city.   0 . 1 , 0 . 1 . this parametrization captures the idea that the sellers have to post a price, which cannot be much  higher than the market price. therefore, most bargaining power is on the buyers side.   y 1 15 , delta1 5 and k 10 . these parameters are chosen together to model a speci c income distribution. the absolute  magnitudes of y 1 and delta1do not matter, only their ratio delta1 y 1 determines the inequality in the income distribution. while  these values for y 1 and delta1have been used to produce fig. 3 , in table 2 we list all the values that correspond to the  twelve income distributions used in section 4 .   gamma1k gamma1 is the income category distribution of k buyers. when vary  ing the income distribution we only change delta1and y 1 , keeping gamma1k gamma1 xed.  references