computers, environment and urban systems 90 101709 available online 25 august 2021 0198 9715 2021 elsevier ltd. all rights reserved.discovering income economic segregation patterns a residential mobility  embedding approach  tong zhanga, , xiaoqi duana, david w.s. wongb, yashan lua  astate key laboratory of information engineering in surveying, mapping and remote sensing, wuhan university, wuhan 430079, china  bdepartment of geography geoinformation science, george mason university, fairfax, va 22030, usa  article info  keywords  income  segregation  isolation exposure  graph embedding  community type abstract  as most studies of segregation rely on the evenness dimension, this current study proposes a graph embedding  approach to explore the usefulness of employing the isolation exposure dimension to evaluate income segregation. while most segregation studies analyzed the static distribution of population subgroups, current study  attempts to classify neighborhoods based on house value as a proxy of income, residents exposure to people of  different income levels as constrained by their mobility patterns, and amenities available in the neighborhood.  this study exploits the graph embedding method to classify neighborhoods by combining their various attributes,  static population distribution and mobility data provided by smart cards to analyze income segregation in  shenzhen, china. results identify four types of communities with different economic statuses, mobility patterns,  and amenity characteristics. they provide rich descriptions about the connections between income segregation  patterns, population dynamics, and neighborhood characteristics. the study found that the more segregated  communities, which are composed of the poorest and richest groups, are mostly in the peripheral regions of the  city while the inner city has lower levels of segregation, mainly due to differentials in transit accessibility. the  study demonstrates the great potential of the proposed method to incorporate multiple aspects to evaluate  segregation.  1.introduction  segregation, which may be broadly described as the spatial separation between different population groups, can be characterized as a  multi contextual and multi faceted phenomenon .  it can be cross classified by different socio geographical spaces and population subgroups  defined by various socio demographic characteristics. among these  multiple contextual and social settings, racial ethnic segregation in the  residential space is among the most heavily studied . while income segregation is not a frequent term in the literature, its source, income inequality, has been intensely scrutinized.  income inequality concerns the disparities in income level among  individuals, households families or population groups, while income  segregation refers to the spatial separation of people with different income levels. the causal connections between income inequality and  income segregation are complicated and have been approached from  multiple perspectives, including health, education, residential structure,  and racial inequality . nevertheless,  causal relationships between them are likely dependent on the particular societal structure . despite developing  nations face many types of inequality, including health and health care   and income , most studies of income and economic segregation focused  on developed nations. studies of income segregation in developing nations such as china are scarce .  many recent studies of measuring segregation are still framed by the  five dimensions of segregation evenness, exposure isolation, concentration, centralization, and clustering . the  well known gini coefficient , which is an evenness measure,  offers a summary measure of income inequality, but is insufficient to  capture the nuance income segregation patterns over space and time.  subsequent modifications such as the generalized neighborhood sorting  index attempt to augment the power of gini  coefficient in discerning spatial patterns. nevertheless, these measures  are based on the evenness dimension. other dimensions, such as  isolation exposure have not been thoroughly explored in studying   corresponding author.  e mail address zhangt whu.edu.cn .  contents lists available at sciencedirect  computers, environment and urban systems  u zkw s yo kr o 1ow o to 1m y2w m k o2mo  https doi.org 10.1016 j.compenvurbsys.2021.101709  received 11 march 2021 received in revised form 12 august 2021 accepted 16 august 2021 computers, environment and urban systems 90 101709 2income segregation.  on the other hand, studies of income segregation mostly focus on the  residential space, reducing segregation to purely the static distribution  of different population subgroups across neighborhoods . these studies conceptualize segregation as the spatial patterns of  disparities, implicitly assume that population subgroups in different  residential areas are completely static, neglecting the possible social  interactions among these subgroups in other socio geographical spaces,  such as work, school and culture . in the context of  income segregation, even if poor and rich people reside in different parts  of a city, the interactions between them, if any, should be considered  when evaluating segregation of all income groups. the current static  treatment of population distribution used in measuring income segregation also fails to exploit the voluminous human mobility data that may  reflect the interactions among population groups.  studies measuring segregation typically focus exclusively on one  population characteristic of concern , putting neighborhood characteristics aside. study results show  that some areas are more segregated than others, but should it be a  concern the general concern about segregation is that people are  separated and unequal. however, traditional segregation measures  cannot reflect how unequal that people may experience in different  neighborhood environments. the proposed approach in this study attempts to consider neighborhood characteristics.  this article is framed around the objectives to tackle the limitations  of existing approaches in measuring segregation enumerated above.  instead of relying on evenness measures as in most segregation studies,  this current study explores the usefulness of isolation exposure dimension to measure income segregation by exploiting human mobility data  that depict the potential spatial interaction among people with different  income levels. methodologically, this study employs graph embedding,  a data mining based visual analytics method, to combine static population and mobility data, and neighborhood characteristics to analyze  segregation at fine grained scales. the study uses data from shenzhen,  the fourth largest chinese city to demonstrate the feasibility and utilities  of the proposed approach and method. as income data are generally not  available in china, we use house value as a proxy of income level in the  current study. however, the proposed framework can use other indicators of economic status to evaluate segregation.  2.limitations in the current practices of measuring segregation  in this section, we review relevant segregation studies in three areas   segregation encompassing multiple socio geographical spaces,  segregation indices, and data used in segregation studies. these reviews justify the needs of the proposed approach.  2.1. segregation encompassing multiple socio geographical spaces  most segregation studies focused on the state of population in a  single socio geographical space within a given time frame. this tradition either is  interested in the segregation condition in only a specific socio  geographical space or assumes that the particular socio geographical space is overwhelmingly important that situations in other spaces may be ignored. thus, studies following this  tradition are limited to assessing the distributions of population subgroups across areal units over a region using aspatial and spatial measures. this tradition also assumes a static view of the population  distribution that segregation is determined by where people are within a  specific socio geographical space , and whether they  interact through other socio geographical spaces is  irrelevant. such approach in evaluating segregation ignores the potential importance of people s interaction across multiple spaces and undermines the roles of individual s activity space and mobility patterns in  influencing one s segregation experience . conceptually, potential interaction among population groups can be reflected by the  mobility patterns of individuals, and thus their activity spaces across all  socio geographical contexts should be accounted for in evaluating  segregation.  although atkinson and flint was likely the first proposing the  use of time space trajectories of individuals beyond their place of residence to evaluate segregation, studies on segregation relying on the  activity space concept to include multiple socio geographical spaces  have gradually gained momentum over the past decade . many of these studies investigated segregation  under the framework of time geography, utilizing individual spatiotemporal trajectories to measure segregation. some methods include  comparing spatiotemporal trajectories ,  community based random walk analysis , developing single segregation measures  , and applying regression based measures . however, these studies considering multiple socio  geographical spaces focused on racial ethnic segregation exclusively.  income segregation involving multiple socio geographical spaces has  been very much ignored.  besides using activity space as the framework to evaluate segregation, another recent direction in segregation study is the domain  approach . this approach is similar to  the activity space approach that acknowledges segregation to be present  in multiple socio geographical spaces. but different from the activity  space approach which often collapses multiple socio geographical  spaces in evaluating segregation, the domain approach focuses on the  connections of segregation situations across domains through space and  time, such as the connections of segregation between residential and  economic , work  , school , and entertainment spaces.  the domain approach advances segregation study not only by  considering multiple socio geographical spaces, but to assess relationships of socio spatial processes among domains, providing a framework  to understand segregation from a comprehensive societal perspective.  however, the domain approach often requires rich individual level data  about the socioeconomic and demographic characteristics of individuals, beyond simple locations or travel trajectories of individuals.  such rich individual level data are not available for the current study of  shenzhen, although the proposed method can easily accommodate the  rich individual level socioeconomic and demographic data.  2.2. limitations of using indices  traditional data sources for time geography rely on surveys as such  travel diaries ,  which are usually small in size. recent data depicting individual trajectories, such as cell phone data , and location based social network data   are usually large in volumes. despite the richness of  data capturing people s mobility patterns within their activity spaces,  most of these studies still rely on global segregation indices, summarizing population characteristics across subunits for the entire region   complex interaction patterns among population subgroups are  reduced to single segregation indices. although these indices have a long  history in the literature, each measure captures only limited aspects of  segregation . thus, using multiple t. zhang et al. computers, environment and urban systems 90 101709 3indices has become more common to ensure more comprehensive results  . it is  important to note that these measures have been mostly employed in  studying ethnic segregation in the residential space.  in the context of measuring income segregation, traditional measures  have a major limitation. among various measures of income inequality,  gini coefficient is probably the most popular . thus, some measures of income segregation conceptually rely on gini coefficient, including those deviations measures , such as the neighborhood sorting index and its generalized form , and the centile gap index . all these  measures are conceptually evenness measures ,  with some of them smoothing values spatially. while using evenness   measures to evaluate income distribution across  neighborhood is reasonable, such approach focuses entirely on the static  residential distribution of people labeled by their income levels,  ignoring their potential interaction with different income groups in  other socio geographical spaces. in the context of measuring segregation  that accounts for the interaction or mobility patterns of population  subgroups, measures capturing the exposure dimension have been the  preferred choices of measures . thus, evaluating income segregation based on a single  index, or multiple indices of a single dimension has significant limitations if both the income differences and cross income group interaction  need to be considered.  segregation studies often report how subgroups defined by the  chosen population characteristic are separated spatially . a logical follow up question is whether these separations of  subgroups matter if subgroups face similar environments . however, many studies argue that separation leads to unequal outcomes, for instance, in education  and health , among others. inequality associated with segregation is often attributable to the spatial disparities of  environmental conditions and resources, which are not reflected by  existing segregation measures. this is another limitation of the index  based approach to study segregation.  2.3. limited data sources  the discontentment of relying only on indices to evaluate segregation is reflected by various analysis tools developed to investigate  segregation patterns, trends, or contributing factors in recent years.  wang, li, and chai leveraged a kernel density estimator to  examine the social segregation of residents in beijing. j arv et al.  assessed the exposure among population groups by determining the  extent that different groups share the same activity locations . wang,  edward, small, sampson utilized a set of analysis tools,  including clustering, descriptive statistics, and linear regression to  examine the composition of activity spaces of 50 largest american cities.  olteanu, randon furling, and clark proposed to evaluate urban  segregation at all scales using the kullback leibler trajectories. a subsequent study adopted self organizing maps to perform cluster based  analytics on segregation patterns .  several studies reviewed above have partly demonstrated the utility  of multiple sources of data that capture both the spatiotemporal dynamics of population and population s socio demographic characteristics. most studies as of today rely on either data about population  subgroup distributions such as census data, or mobility data from surveys, cell phones or social media. studies rarely, if any, take advantage  of data from multiple sources, capturing both the spatiotemporal dynamics and the socioeconomic characteristics of the population, and the  neighborhood characteristics. 2.4. the needs for new methods  we here argue that to evaluate segregation comprehensively requires  integrating heterogeneous data that capture different aspects of segregation, including the spatiotemporal dynamics and sociodemographic  characteristics of population, and the characteristics of neighborhoods.  to accommodate the diverse types of data, a data intensive and flexible  analytical scheme is warranted. such scheme should be able to utilize  heterogeneous data collected at the neighborhood level, and these data  may be used to identify local areas sharing certain segregation characteristics in multiple dimensions. while some neighborhoods sharing  similar segregation characteristics may be spatially clustered, forming  mesoscale subregions, other neighborhoods with similar characteristics  may be scattered across the study region, creating a complex spatial  pattern with heterogeneous neighborhoods. the resultant segregation  structure can facilitate our understanding of how different population  groups are spatially distributed and spatiotemporally interacted across  the region, potentially revealing the underlying socioeconomic forces  driving segregation.  to leverage heterogeneous data to evaluate segregation, methods  beyond computing indices are needed. machine learning based data  driven methods have advantages over the traditional index based  approach because they have the capabilities to extract segregation patterns and structures from multiple dimensions . we argue that segregation of an area does not have to be indicated by one single number. we call for an expressive method to capture  segregation dynamics with compact representations while at the same  time preserving the original socioeconomic, neighborhood and mobility  information as much as possible. representation learning provides a  powerful framework to capture discriminative and expressive information from massive data and can be  employed to represent and extract spatiotemporal segregation structure.  in particular, graph embedding meets this need as it strives to preserve  graph structure and attribute information with compact vectors .  this study leverages multi source data to examine the macro  structure of income segregation. in particular, we evaluate income  segregation from the isolation exposure dimension by integrating income and mobility data, going beyond the use of evenness based measurement on static population distributions and accounting for potential  interactions between different income groups in different socio  geographical spaces. we leverage graph embedding to develop a  comprehensive representation scheme at fine grained scales to analyze  the massive smart card, amenity and housing data of shenzhen city,  china. results deliver a holistic depiction of income segregation,  including the spatiotemporal and neighborhood aspects of segregation.  3.a residential mobility embedding approach to study  segregation patterns  3.1. graph and graph embedding  in the context of graph analysis, nodes can represent areal units such  as census tracts, zip codes or grid cells, whereas the weights of links  between nodes quantify the movement intensities between nodes. these  nodes representing areal units can be characterized by various socioeconomic and demographic attributes. thus, the entire graph offers a  holistic description of the spatial system, capturing both the characteristics of places and the interaction of places. this graph based  representation provides a convenient tool to incorporate heterogeneous and comprehensive data relevant to segregation studies.  machine learning methods have been employed to analyze graphs,  performing a wide variety of learning tasks such as link prediction  , node classification , community detection , and visualization . however, it is t. zhang et al. computers, environment and urban systems 90 101709 4imperative to develop automatic latent representation methods to  encode complex graph structures and dynamics into compact low  dimensional vectors in the euclidean space, which significantly facilitate the use of many downstream machine learning algorithms . this encoding or projection scheme is  termed graph embedding . as the original graph data capture rich  structural and attribute characteristics of nodes and links, the embedded  representation should preserve the original topological structure, content, and attributes .  fig. 1 illustrates embedding nodes of a graph into low dimensional  vectors, which preserve the original graph structure and attribute information. node colors in fig. 1, for  instance, represent different socio economic standings of corresponding  areal units, and different link widths represent the numbers of inter  nodal trips or the interaction levels between pairs of nodes. then  graph embedding constructs a d dimensional vector representation for  nodes in rd. fig. 1 shows the output embeddings in r2 that preserve  information based on graph structure and node attributes. for example,  nodes 7, 9, and 10 should be embedded closely because they are strongly  inter connected with similar socio economic profiles. recently, the use  of graph embedding in spatial networks has garnered increasing cross  disciplinary attention. human mobility data and local attribute information are jointly embedded to discover urban structures or functions  .   an attributed graph. graph embeddings in 2d space.  3.2. assessing income segregation using graph embedding  to study income segregation, the proposed approach considers not  just the income status of the population, but also 1 the interaction  among different income groups captured by mobility data from which  the activity patterns of residents can be extracted, and 2 the characteristics of neighborhoods, which may include socioeconomic variables  of the population. neighborhood characteristics are regarded as attributes of nodes in the proposed framework. these data can be depicted  by graphs efficiently, and graph embedding, a deep representation  learning method, will be used to identify communities of different experiences to advance our understanding of income segregation patterns.  a weighted attributed graph g is defined over n areal  units of the study region. the set of graph nodes v corresponds to areal  units and the set of graph edges e denotes inter nodal interaction or  connection. each node i is associated with an f dimensional attribute  vector hi f. embedding of g is created by learning a low dimensional  vector representation y d for each node in v where d ddf. these  nodal embeddings are then used to examine segregation.  fig. 2 presents the proposed deep learning based graph embedding  and community detection method that unifies representation and analysis in a complete pipeline. the study region is partitioned into a regular  grid and the grid is then modeled as a directed graph. each grid cell is represented as a graph node and each link denotes people s trips from a  node to another. each node is described by multiple attributes, which  may include population s socioeconomic characteristics and environmental properties. segregation is partly determined by people s mobility  patterns reflected by inter nodal links, which encode the intensities of  interaction or exposure of people between nodes. segregation is also  partly reflected by the differences in attributes between nodes. exposures to people in other units and similarities in attributes between areal  units are captured by two matrices that are constructed from the graph.  together, the two matrices capture the dynamic geographic context that  residents may experience during their daily life. they form the bases of  our segregation representation and analysis.  fig. 2 depicts an attributed graph embedding scheme used to integrate the links or exposure between nodes with the node attributes based  on an autoencoder model . after nodes are  embedded, types of communities are detected by clustering the  embedded nodes. a multivariate gaussian mixed model is used to enrich the representation of community  types, and improve nodal embeddings and community type detection  through an iterative optimization process. we improve the existing  attributed graph embedding scheme by incorporating a new loss function to minimize the error  between the input and output vectors in each node. we adapt the  original iterative optimization method to detect  community types with similar segregation experiences. we combine the  graph embedding and community detection schemes into a unified end  to end training framework by back propagating the loss of the integrated optimization to the autoencoder to improve the node embedding  results. these steps and methods are elaborated below.  3.3. definitions  fig. 2 has two matrices attribute similarity matrix and exposure  matrix.  definition 1.attribute similarity matrix, wattr, which reflects the  attribute similarity between all pairs of nodes , is defined by  a radial basis function  wattrcij exp   hi hj 2 2 2 2    where hi is a vector of attributes in the i th area, 22 represents a  similarity measured in l2 norm, and is a learnable parameter.  the attributed mobility graph also captures interaction of population  between areas . a mobility matrix is constructed to represent the  interaction exposure characteristic.  definition 2.mobility based exposure matrix, wexp, is an asymmetric matrix that encodes the level of exposure among population  groups based on mobility. in the context of income segregation, we may  divide the population into, say four income groups by quartiles. each  element of the exposure matrix can be defined as  wexpci j ii j oi j  where ii j and oi j reflect the first order exposure and second order  exposure of the j th area to the i th area. the two types of exposure  can be computed accordingly .  ii j m gcg kpjcg m katti jpi jck  m gpjcg m kpi jck   graph embeddings in 2d space.
fig. 1.an illustrative example of graph embedding. node colors represent different attribute values of areal units. widths of arrows  represent the interaction intensity levels between nodes. t. zhang et al. computers, environment and urban systems 90 101709 5oi j n t   m gcg kattj tpj tcg m katti tpi tck   n t   m gpj tcg m kpi tck  the direct exposure ii j is dependent on the direct trips from i to j,  while the indirect exposure oi j includes the trips from i to j but through  an intermediate location t and there are n intermediate locations. population is divided into m income groups. in the above eqs. , pj, g is  the number of total travelers of income group g that arrive at area j, pi j,  k is the number of travelers of income group k  departing from area i to area j .  because exposure is measured between two different income groups , travelers from the same income group are not counted in the numerators in eqs. . the numerators in the two equations quantify the  potential interactions between different groups when they arrive at j or t.  the denominators enumerate all possible interactions between different  groups without the accessibility constraints, i.e., regardless of the  occurrence of actual trips. atti j is the attraction to area j from area i  , and it is defined as  atti j ni j njsigmoid ti j tj    where ni j is the number of trips from area i to j, nj is the total number of  trips that end at j, ti j represents the average trip time from i to j, tjis the  average time for trips that end at j. the formulation of the attraction is  based on the premise that an area is more attractive than other areas if  people are willing to take longer and more trips to this area than to other  areas. in other words, attraction is positively proportional to trip number and travel time.  3.4. an auto encoder model for node embedding  we use an attributed embedding algorithm to  integrate the exposure dimensions in the activity space and node attribute information to evaluate segregation across areal units . the algorithm employs an auto encoder to enforce information  sharing between the attribute similarity matrix and the exposure matrix  at the node level. the auto encoder consists of an encoder and a decoder.  the encoder produces hidden representations for input vectors in graph  nodes and the decoder reconstructs data vectors from hidden representations. assuming that there are k layers in the auto encoder, we  have y1  wattr  w1 t b1    yj  yj 1  wj t bj    yk 1  yk 2  wk 1 t bk 1  yk  yk 1  wk t bk  where the initial input is the attribute similarity matrix wattr. yj  denotes the representation of the joint hidden representation for the  attribute similarity and exposure matrices of the j th layer of the  encoder, wj and bj represent, respectively, the weight and bias vectors  for the j th layer, yk is the final output.  the decoder aims to reconstruct the initial input based on the joint  hidden representation yk.   y1  ykt  b1   y2   y1t  b2     yj   yj 1t  bj     yk   yk 1t  bk  where wj and bj represent the learnable weight and bias vectors for the  jth layer in the decoder.  a learnable weighting loss function is developed to regulate the influences of the attribute similarity matrix and the exposure matrix at the  node level. the loss function is,  min n icjwexpci j yik yjk 2 2  where yikcyjk are the i th and j th vectors after embedding. the exposure  matrix, wexp, i j, which was defined in eq. , is used as a constraint in  the loss function to ensure that both attribute similarity and exposure  information are accounted for.  also, we define the reconstruction loss as  min n i yi1 yik 2 2  the similarities of the two matrices between graph nodes are  fig. 2.illustration of the proposed unified representation and analysis pipeline. t. zhang et al. computers, environment and urban systems 90 101709 6preserved by minimizing reconstruction errors between input vectors  and reconstructed vectors. the overall loss function can be defined as  lt n i yi1 yik 2 2 n icjwexpci j yik yjk 2 2  where is a learnable parameter that regularizes the contribution of the  reconstruction loss function .  to minimize the overall loss, we use the backward propagation  method to obtain the joint embedding for each node, relying on the  adam optimizer under the pytorch framework.  when the loss stops decreasing, the training process stops and the  resultant auto encoder can be used to produce nodal embeddings, which  are normally represented as one dimensional vectors.  3.5. segregation based community detection and representation  after nodes are embedded as compact representations of one  dimensional vectors based on their attribute characteristics and inter  nodal interaction, these node embeddings are clustered to derive community types. areas sharing similar attribute and exposure profiles form  a community type. areas belong to the same community type have  similar patterns of exposure to other community types. the derived  community types exhibit salient segregation structure characterized by  exposure between income groups and differences in community attributes, thereby facilitating segregation studies and policy making. as  one dimensional vector is used as the default form of node embedding,  representing community types by one dimensional vectors may oversimplify the complex composition of community types since a community type usually contains multiple nodes. instead, we use a multivariate  gaussian mixture model to enhance the expressiveness of  community embedding . each community type is  characterized by a mean vector and a covariance matrix, which when  combined, define a multivariate gaussian distribution. the mean vector  and covariance matrix together provide the overall characteristics and  internal heterogeneity of a community type.  however, node embedding and the subsequent clustering processes  may not produce highly compact community types because the initial  node embedding process does not sufficiently account for the cohesiveness of community types in the embedding space. the mean vector  denotes the center of a community type whereas the covariance matrix  encodes the compactness of its node members in related to the center.  because community type detection may be regarded as a typical unsupervised learning problem, we follow the principle of k means clustering and combine node embedding, community detection, and  community embedding into an integrated unsupervised optimization  model that iteratively derives optimized embeddings of nodes and  community types, along with community structure . node embeddings can be improved by reducing their dissimilarities with their community type centers, based on the assumption that  nodes belonging to the same community types should be embedded  closely to the community type centers. similar to the k means clustering  method, this process iteratively repeats until convergence. when this  joint optimization is performed, loss information is back propagated to  the joint embedding scheme to derive improved  node embeddings. through updated node embeddings, nodes that are  expected to belong to the same community types will have more similar  embeddings. then a more consistent community type structure can be  discovered after each iteration.  assuming that we have m types of communities, each community  follows a multivariate gaussian distribution, where u rd and   u rd d are the mean and covariance of node vectors in the u th type.  then the objective is to extract community types possessing certain  segregation characteristics. each type consists of multiple areas and  areas with the same gaussian distribution belong to the same type of community. the most suitable number of community types is identified  by the gap statistic model . to unify the  community type detection and embedding into an integrated optimization framework, we need to optimize the following likelihood function     n i 1 m u 1pr vi cu pr vi vi cucyic uc u  where pr denotes the probability of node vi being classified as  the u th type. yi is the node embedding for vi.  the loss function for the integrated optimization can be defined as  lg  m n i 1log m u 1pr vi cu pr vi vi cucyic uc u  where is a trade off parameter.  the optimal node and community type embeddings can be derived  by minimizing the loss function in eq. . meanwhile we can also  obtain the optimum pr, with which node embedding can be  updated based on eq. by assuming yi is unknown. this iterative  node embedding process has the benefit of directing nodes of the same  community type to have similar embeddings.  fig. 3 illustrates the iterative learning for community type detection  and the update of node embedding and the final community embedding.  initially, three community types are detected based on node embeddings  . each detected community type can be described by a gmm  based embedding . in each iteration, node embedding is updated by fixing community type embeddings and community type membership probabilities and optimizing eq. . after obtaining improved  node embeddings, new community type structure and updated  community type embeddings are derived . finally, this process  converges and community type structure should be more compact than  previous iterations in the embedding space as nodes are embedded  closely to the community type centers .  4.data and results  the methodology described above was applied to detect community  types with different characteristics of income segregation in the city of  shenzhen. in the current study, income segregation is characterized by  house value differentials, exposure to residents of different community  types, and community amenity levels.  4.1. study region and data  shenzhen is the largest city in southern guangdong province in  china bordering hong kong to the south. while it is one of the largest  and fastest growing chinese cities, it is a relatively new city with highly  uneven levels of development. the city is divided into ten administrative  districts with the more developed one concentrated in the west and  southwest. data used in the study are described in table 1.  as income data are in general not available in china, housing price is  treated as a proxy variable of income of a household as house value  should be a reasonable indicator of a resident s income level. housing  price data were obtained from the website of lianjia , the largest chinese real estate brokerage company . as  the website indicated house values by point locations, spatial interpolation was used to generate a housing price surface for the entire city.  the entire city is divided into 100 m by 100 m grid cells. using the  inverse distance weighting interpolation method, a house value  was estimated for each grid cell. after unpopulated cells were removed,  cells were further consolidated into grid groups or communities. in  operation, transit networks with stops were overlaid onto the grid. cells were assigned to the nearest stops and cells  sharing the same stops are grouped together to form t. zhang et al. computers, environment and urban systems 90 101709 7communities. thus, these communities are formed by grouping grid  cells with similar transit boarding profiles, i.e., the same nearest stop or  a list of similar boarding stops .  for each grid group , its housing price is calculated by  averaging over its constituent grid cells. interpolated housing prices for  communities in four categories are shown in fig. 4.  fig. 4 shows that residents with higher income levels tend to live in  the southwestern part of the city , which hosts the  major employment centers and high paid jobs. western part of the city  also has much higher average housing prices than the eastern part. at  the regional district level, income segregation based on housing price  seems high using the evenness dimension. however, house values vary  significantly at the local scales in the downtown area, revealing the  highly uneven spatial distribution of wealth. in our analysis framework, housing values and densities of different  point of interest types are regarded as attributes of nodes from  which the attribute matrix is derived . six types of poi are used in  the study government agencies, commercial, educational, recreational,  medical services, and tourist sites . although other types of  pois can be used, these six types are chosen mainly to capture the  amenity richness of each community and to a certain extent, its attractiveness to visitors. the downtown area includes large numbers of pois.  however, high income is not strongly associated with the numbers of  pois. the numbers of government, commercial, and educational pois  have weak positive correlations with housing values . density of a poi type is  computed by dividing the number of a poi type by the area of the  community. for each community , a vector is constructed to  include housing values and densities of different poi types as attributes.  as in most large and medium cities in china, shenzhen has a very  well developed transit system served by buses and subways. transit  fares are paid by smart cards. in this study, we used smart card data   gathered by the transportation authorities of the city during the  week of april 3 9 cavallari et al., 2017 . this massive data set contains  complete boarding and alighting records of individuals for subway  transactions but only the boarding time for bus based trips. to reconstruct the complete trip chains for both subway and bus trips , we reconstructed bus based trip legs by estimating  boarding stop, alighting time, and alighting stop of each trip leg . to estimate these leg components, bus trajectory dataset is  integrated with the scd to identify the most probable boarding stop for  each leg. then the alighting stop and time for the leg are inferred based  on the common assumption that the most likely alighting stop is closest  to the next boarding stop. finally, separate trip legs are linked together  to form complete trip chains if consecutive legs are within 30 min . based on this derived data set,  which includes commuting and non commuting trips, the exposure  matrix capturing people s mobility patterns is constructed for the community structure .  4.2. segregation analysis  4.2.1. detection and analysis of segregation structure  the embedding process considering income characteristics, exposure  of income groups across communities and neighborhood characteristics  produces four types of communities, and their income group compositions are shown in fig. 5. the patterns between weekdays and weekends  are highly similar. type 1 communities are dominated by the lower  income groups, while the majority of type 4 communities have the  higher income groups. between the two are type 2 and 3 with type 3  very similar to type 1. type 2 income composition is not very similar to  type 4, but it has the highest proportions of higher income groups after   fig. 3.iterative community detection and embedding updating initial results, intermediate results with improved likelihood, final results with the most  compact embeddings.  table 1  data description.  data description  smart card data   complete boarding alighting records for subway transactions  but only boarding time for bus based trips  communities dividing shenzhen into 100 m 100 m grid cells , and merging grid cells into 18,108 communities with similar transit boarding patterns  community  attributes point of interest positions and types  housing price data crawling housing price from the lianjia website .  fig. 4.interpolated housing price for the 100 m by 100 m  grid, shenzhen, china. housing values are categorized into 4 classes based on  natural breaks. t. zhang et al. computers, environment and urban systems 90 101709 8 fig. 5.proportions of income groups in each of the four types of community types .   weekdays fig. 6.detected segregation community type structure. t. zhang et al. computers, environment and urban systems 90 101709 9type 4.  spatial distributions of the four types of community are shown in  fig. 6. type 1 communities are mostly found in the outskirts of the city  where subways are poorly served. on the contrary, type 4 communities  are concentrated in and around the downtown region in the south  southwest part of the city. however, it is important to note that city  center is not exclusively occupied by type 4 communities. many of these  communities are also found along subway lines outside the city center  and even in terminus areas of the subway lines far away from the city  center.  since the averages of distances to stations and trip lengths between weekdays and weekends for each of the four community  types are quite similar, therefore, weekdays and weekends are not discussed separately here. type 1 communities are characterized by very  low rates of exposure to the rest of the population regardless of income  level as shown by the low ratios of inflow trips to the local populations in  fig. 7 . the low ratios of inflow trips reflect that the numbers of  people in all four income groups from other types of communities are  small as compared to the residential population in type 1 communities.  in other words, adopting the exposure dimension of segregation, residents in type 1 communities are highly segregated from residents in  other communities, due to their low exposure levels. they are relatively  isolated partly due to the geography that they are mostly located in areas  with poor public transit access . the low transit accessibility levels in these communities are reflected by the longest average  distances to the nearest subway stations . the costs of  residents in these areas to access transit services are relatively high.  also, trips originated from these communities are the longest on  average, though not by a large margin, further exemplifying the  inconvenience of using transit for type 1 communities. notably, type 1  communities cover areas of two income extremes when these communities are compared with the  housing map in fig. 4 and the income composition in fig. 5. due to the  lowest exposure levels to residents in other communities and the highest  costs to reach other communities,  type 1 communities maybe regarded as the most segregated community  type based on the high costs of access to transit and low inflow ratios. we  note that both type 1 and type 3 communities are distributed in remote  suburb areas with relatively low housing prices. the main difference  between the two types is the access to the subway system type3 communities generally are close to subway stations, making them easier to travel by transit whereas type 1 communities have longer walking  distances to nearest subway stations. this difference leads to lower  exposure levels of type 1 communities than type 3 communities since  people from other areas are difficult to access type 1 communities via  subways.  on the contrary, type 4 communities are close to major subway  stations , enjoying high levels of  transit accessibility and interaction with people from different income  groups as reflected by the highest ratios of inflow trips to the local  population . also, type 4 communities have relatively  large numbers of pois and job opportunities ,1 further attracting people in other communities to visit and thus  elevating the exposure levels of local residents. the situations of types 2  and 3 communities fall between the two extremes of types 1 and 4. they  have moderate levels of exposure to residents across income groups  . a difference between types 2 and 3 communities is that  type 3 communities are slightly less accessible than type 2 communities  since most type 3 communities are located in the suburbs connected to  one single subway line while many type 2 communities can be  accessed conveniently by transit services. compared to type 3, residents  of type 2 communities experienced higher exposure levels to residents  in other types of communities as indicated by their higher ratios of inflows to local population over those ratios for type 3 communities  . fig. 6 also shows that communities in the downtown area  are more spatially fragmented than in other areas, indicating that  community differentiation is highly localized in the downtown area.  although accesses to subway stations in terms of distances are clearly  different across the four community types, average trip lengths do not  vary tremendously across community types. this phenomenon has at  least two implications. people belonging to different community types  made transit trips of similar distances. note that community types are  not straightly defined by their city center peripheral settings as trip  length is not an attribute in formulating community types. nevertheless,  the rank correlation between the access to station and the average trip  length across community types is perfect . taking both access to stations and  average trip length together as time cost, type 1 communities pay the  highest cost in order to interact with others and type 4 communities pay  the least.  although, transit access and trip length patterns between weekdays  and weekends are similar , the community exposure  patterns to different income groups, which are shown by the ratios of  inflow trips from the four income groups in other communities to the  local population, have several noticeable differences between weekdays  and weekends . clearly, residents are more reluctant to  travel by transit on weekends than on weekdays. therefore, exposures to  residents from other communities on weekends are lower than the exposures during weekdays. in other words, people across all community  types are more segregated on weekends than on weekdays. assuming  that trips made on the weekdays are job related, then jobs help lower  segregation across communities. this claim is further substantiated by  the fact that type 4 communities are densely populated by multiple  categories of pois , attracting travelers across the city.  across all four types of communities, the medium high income group  is the largest group of visitors on the weekdays but is the smallest group  of visitors on weekends, based on the ratios of inflow trips to local  population . thus, people in the medium high income  group travelled the most among the four income groups on weekdays,  possibly related to their jobs, but on weekends, they travelled the least.  on the contrary, people in the high income group travelled the least on  weekdays, but the most on weekends, likely for leisure. from the  fig. 7.four types of community defined by the average distance to the nearest subway stations and average trip length , and the ratios of inflow trips from the four income groups in other communities to the local populations . 1 according to the company location data from baidu map, the density of  companies for the four types of communities on weekdays are 101.8, 285.6,  201.8, and 360.0 per km2, respectively. t. zhang et al. computers, environment and urban systems 90 101709 10segregation perspective, medium high income population has the  highest level of exposure to various communities on weekdays, but the  lowest exposure on weekends. high income population is the most isolated on weekdays, but exposed to other groups the most on weekends.  among the four types of communities, type 1 has the lowest exposure to visitors while type 4 has the highest exposure level. types 2 and  3 have intermediate exposure levels with type 2 having slightly high  levels. thus, based on the exposure levels to visitors, type 4 communities may be regardless as the least segregated or isolated, while type 1  communities may be the most isolated. however, fig. 7 fails to describe  how populations in the four types of communities interact. fig. 8 provides some insights about their interactions.  in fig. 8, width of an arrow is proportional to the size of normalized  flow, including the within type trips. the normalized flows between  type i and type j communities can be calculated by multiplying the  origin frequencies with destination frequencies. nf i j ni j nicout ni j njcin  where ni j is the number of trips from community i to j, ni, out is the total  number of trips leaving i, nj, in is the total number of trips arriving at j.  size of a circle in fig. 8 is proportional to the total area of the corresponding community type. bar chart inside each circle displays the  ratios of pois over the total poi numbers for the six poi categories.  arrows in fig. 8 indicate that type 4 communities have the highest  levels of interaction with other types of communities. in particular, they  attract the largest volumes of flows from types 2 and 3 communities on  both weekdays and weekends. therefore, type 4 communities have the  highest exposure levels as they function as activity hubs for residents  from most types of communities across the city. on weekdays, type 4  communities attract substantial trips from areas with medium low and  low income groups , although the medium high group constituted the largest inflow stream. these patterns should not be surprising  as type 4 communities have disproportionally large number of pois  . type 4 communities also have the  largest normalized within community flows on both weekends and  weekdays.  due to poor transit accessibility and the small numbers of pois, trips  end within type 1 communities are comparably less than other community types, thereby validating that they are probably the most  segregated areas in the city on both weekdays and weekends. type 1  communities also occupy the most area on both weekdays and weekends, while type 4 is the smallest by area. interaction between type 2  and 3 communities is substantial but interaction between type 1 and  type 3 is relatively minor on both weekends and weekdays, suggesting  that type 3 may be less exposed to other types of communities than  those of type 2. on weekends, lowered interaction levels across community types raise segregation overall . such lowering of inter  community interaction is accompanied by the slight increases of intra  community flows for type 1 and type 3 communities, reinforcing  their isolation from residents in other types of community on weekends.  4.2.2. measuring local exposure  based on node embeddings, we developed a local exposure measure  that quantifies the exposure level of each community or grid group. the  idea is to measure the similarity between a learned real world node  embedding and a local mobility based theoretical embedding of a node.  this local theoretical embedding is computed based on a non parametric  radiation model that improved the well known newtonian based gravity model to model spatial interaction .  in this radiation model, the volume of inflow trips of a node is  dependent on the populations of the origin and the destination nodes, as  well as the population in the vicinity of the origin location . formally,  the average inflow trip from i to j can be calculated by,  ti j timimj  mi sij  mi mj sij  where mi and mj represent the populations of i and j, respectively, and sij  is the population within the circular area surrounding i with a radius of  weekdays  weekendsfig. 8.mobility networks of detected community  types. width of an arrow is proportional to the size of normalized flow. size of a  circle is proportional to the area of a different community type. colors of circles  correspond to the colors of community types in the legend of fig. 6. bar chart  inside each circle indicates the ratios of pois over the total poi numbers for the  six poi categories. colors of histograms are annotated in the legend.  table 2  average local exposure measurements over community types. the numbers  following are standard deviations.  type weekdays weekends  1 0.5872 0.0011 0.5509 0.0008  2 0.6360 0.0048 0.6032 0.0009  3 0.5922 0.0015 0.5520 0.0006  4 0.7763 0.0113 0.7271 0.0069 t. zhang et al. computers, environment and urban systems 90 101709 11rij , but excluding the populations of i  and j. ti is the sum of trips originated from i. this radiation form of the  mobility model assumes that people s movement is not affected by the  characteristics of individuals such as income, or the neighborhood  characteristics such as amenities , and the  transportation networks. thus, trip volume estimates provided by eq.   can be regarded as people s exposure purely determined by the  geographical distribution of population in the region. interaction of  people is not restricted by landscape factors or negatively affected by  increasing distance between locations. then,  the local exposure measure of a node i can be formulated as the difference in the exposure levels to other income groups based on the level  estimated by the theoretical or ideal trip volume using the radiation  based mobility model and the level based on the learned embedding  of the node. the proposed local exposure measurement index based on  the notion of cosine similarity can be defined as,  ei cosine  yi yi yi yi   1c1    where yi denotes the learned real world embedding vector for the i th  node. yirepresents the local theoretical mobility embedding vector of  node i, which is computed based on the theoretical inflows . the  local measure has a range of 1,1 , with 1 indicating opposite vector  directions while 1 reflects perfect resemblance in direction of the two  vectors. thus, larger ei reflects closer to the ideal or higher exposure, and  vice versa.  according to fig. 9, ei ranges from 0.5 to 0.82, showing the real  world embedding vectors resemble the ideal ones at moderate to high  levels. the least segregated communities are mostly concentrated in the south and southwest parts of the  city. although some of the least segregated communities are found in the  suburb and periphery regions, they are highly localized in selected locations. areas characterized as the most segregated are mostly distributed widely in the suburban and peripheral  areas. weekends have lower overall exposure levels than weekdays, as  indicated by lower exposure measurements across the study region. on  weekdays, high exposure areas are usually characterized by their high  transit accessibility and attractiveness of concentrated job opportunities.  on weekends, high exposure levels are evident in commercial centers in  downtown areas that are easily accessible by subways.  for many suburb areas, residents need to take much longer trips than  people living in downtown areas in order to access various pois and  opportunities. even they manage to interact with different population  groups, extra transportation costs are significant. when trips are not  required on weekends, suburb residents tend to make less  trips, resulting in much lower exposure levels.  we computed the aggregated exposure measurements for the  detected community types on both weekdays and weekends by  averaging local exposure measurements over all grid groups with the  same community type. results show that exposure levels on weekends are slightly lower than those on weekdays the order of exposure levels is type 1 dtype 3 dtype 2 dtype 4 weekend exposure  levels of different community types are less heterogeneous than those on  weekdays, according to the standard deviations of local exposure in  table 2. the downsizing of trips leads to dramatic decreases of exposure  for types 1 and 3.  4.2.3. comparison to traditional income segregation measures  we further compared the proposed exposure based measures with  the gini based spatial ordering index at the administrative district level. the spatial ordering index is a comparison of the  original neighborhood income parade with the spatially ordered income  parade. it is computed from the ratio between the  spatial gini index calculated from a nearest neighbor and a gini index of  between neighborhood income segregation. it is inherently a spatial  evenness measure based on gini or rankings. fig. 10 shows the spatial  ordering index for the ten districts in shenzhen. based on the proposed  local exposure measure, we computed the district level segregation  index as follows,  sk 1 i i 1ei  ik  where ei denotes the local exposure of node i. ikis the number of nodes  that belong to the kth district.  fig. 10 shows that results between the spatial ordering index and the  exposure based index are dramatically different. just to take two  extreme cases to illustrate the differences futian district, part of the  downtown area, has the highest segregation level according to the  spatial ordering index, but has one of the lowest segregation levels according to exposure. on the contrary, guangming district has moderately  high segregation levels according to the spatial ordering index, but it has  one of the highest segregation levels according to exposure on both  weekdays and weekends. although the two measures are not exactly  opposite in their results, they are in large disagreement in general,  except that dapeng district is ranked highly for both indices. however,  these inconsistent results should not be surprising. while the spatial  ordering index considers only static house values within each district to  capture local variability or evenness, which can easily be derived visually by examining the housing price map in fig. 4, the proposed measure  accounts for population dynamics and thus exposure patterns, and  identifies variability in segregation levels in different times .  as shown in fig. 11, downtown districts in the south generally have low degrees of segregation while less  weekdays  weekendsfig. 9.embedding based local exposure measurement. high exposure index  values indicate low segregation levels. t. zhang et al. computers, environment and urban systems 90 101709 12  dawkins spatial ordering index  proposed exposure based segregation measurement on weekdays  proposed exposure based segregation measurement on weekends  fig. 10.comparison of income segregation measurements at district level. t. zhang et al. computers, environment and urban systems 90 101709 13affluent suburb and exurb areas are more segregated. public transit  accessibility is a key factor districts with high accessibility are usually  associated with low segregation levels. the rank orders of the districts in  segregation levels between weekdays and weekends are slightly  different, indicating that the proposed exposure measurement approach  is capable of capturing the temporal dynamics of segregation.  5.conclusion and discussion  this study proposes using the graph embedding as a representation  and analysis framework to identify community types with similar  segregation experiences. these experiences are characterized by the  level of amenities in the residents communities, residents exposure to  other groups defined by the concerned characteristic . the proposed framework considers  not just population and community characteristics, but also population  dynamics which affect segregation level over time. contrary to the  traditional index based approach which mostly considers one population characteristic  and ignores the community characteristics of the population, results of  the proposed framework provide rich descriptions of segregation experiences of residents and associated environments.  the main contribution of the current study is on the methodological  realm, while the understanding of income segregation of shenzhen is  preliminary and exploratory in nature. shenzhen is a unique chinese  city as it was one of the four earliest designated special economic zones   to jump start china s open door economic policy in the 1980s.  the city literally had no history before 1980. understanding the  development of chinese cities in general and income segregation in  specific need to recognize the larger contexts of china s experience in  globalization and the burgeoning post socialist economy . some of the china s unique urban development phenomena need  to be considered include the influx of floating population and the emergence and removal of urban villages . therefore, comparing the income  segregation geography of shenzhen with that of another city in the  global north and south should account for different urban development  processes and histories . we are aware of a major  limitation of our empirical results. scd were used to extract transit  based trip patterns. because wealthier residents are unlikely frequent  patrons of transit services, mobility patterns extracted might not  represent the situation of this subgroup sufficiently. this is a limitation  of the data, not the framework.  nevertheless, the current study of shenzhen adds to our knowledge  about the socioeconomic landscape of some cities in general. ignoring  the income variability at the highly local scale , in general, shenzhen s residents  with higher income are mostly found in the more developed and highly  accessible districts in the southwest and south, while those resided in the  less developed east side of the city are mostly lower income people  . this simplified center rich periphery poor urban structure is  contrary to the structures of many north american cities , but to a certain degree, are similar to the structure  of some cities elsewhere, including some european cities , and some latin  american cities . higher income groups reside  closer to the city centers while poorer groups are concentrated in the less  accessible peripheral areas.  applying the principles to assess income segregation developed for  shenzhen in this study to other cities, both the spatial distributions of  different income groups and their neighborhood accessibility should be  taken into account. many cities in the developing world are flooded with  informal settlements, most of which are occupied by the poorest population in the least accessible areas , a double  whammy of poverty and isolation. if the poorest sections of the city have  access to efficient transportation, such as those selected locations  beyond the center districts of shenzhen but are near the transit stations,  their segregation levels may be lowered . thus, transportation  infrastructure can be a means to reduce segregation in general.  however, the most segregated communities in shenzhen are  not exclusively constituted by the lower income residents. they also  housed some of the wealthy people, possibly the super rich. the rich,  who likely have personal transportation and therefore their mobility  data are not included in the current study, may choose to be self  segregated, residing in enclaves such as gated communities. these residential locations may be remote and not easily accessible by public  transportation so that they can set certain physical distances from the  rest of the society. such phenomenon exists in chinese cities including  shenzhen and also elsewhere around the world .  in this case, segregation or isolation is intended.  the employed graph embedding representation is a highly flexible  data driven machine learning method that encapsulates characteristics  of nodes and their interactions or linkages into an integrated representation and analysis framework. in the context of segregation study, a  desirable feature of this framework is to capture the movement of people, an important aspect of exposure in evaluating segregation. the  current study employs transit trip information extracted from scd.  other data sources can be used. similarly, the current study uses house  values as proxies of income levels. the proposed framework can  accommodate other attributes to classify population into subgroups.  neighborhood characteristics are defined by six types of pois. apparently, other neighborhood characteristics can be used. in other words,  the proposed framework is highly flexible and adaptable and will open  new avenues for segregation studies.  declarations of competing interest  none.  author statement  tong zhang conceptualization, methodology, writing original  draft, formal analysis, supervision, project administration, funding  acquisition.  xiaoqi duan software, validation, investigation, data curation,  visualization.  david w.s. wong writing original draft, writing reviewing and  editing, formal analysis, validation.  yashan lu software, validation, data curation.  fig. 11.segregation levels of the ten districts in shenzhen, according to the  exposure measure for weekdays and weekends. error bar at the tip of each bar is  the standard deviation of the segregation levels within the district. districts are  sorted according to the segregation levels on weekdays. t. zhang et al. computers, environment and urban systems 90 101709 14acknowledgements  this work was jointly supported by the national key r d program  of china under grant 2019yfe0106500, the national natural science  foundation of china under grant 41871308, and the fundamental  research funds for the central universities.  references